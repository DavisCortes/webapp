<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Smilskiy P2P Academy</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CYBERPUNK THEME ‚Äî DESIGN SYSTEM
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root{
  --bg:#060612;--bg2:#0a0a1e;--bg3:#0f0f2a;
  --surface:rgba(15,15,42,0.85);--surface2:rgba(20,20,55,0.7);
  --glass:rgba(255,255,255,0.03);--glass2:rgba(255,255,255,0.06);
  --glass-border:rgba(255,255,255,0.08);
  --neon:#00f0ff;--neon-glow:rgba(0,240,255,0.4);--neon-dim:rgba(0,240,255,0.15);
  --purple:#a855f7;--purple-glow:rgba(168,85,247,0.4);--purple-dim:rgba(168,85,247,0.12);
  --pink:#f472b6;--pink-glow:rgba(244,114,182,0.3);
  --green:#10b981;--green-glow:rgba(16,185,129,0.3);
  --red:#ef4444;--red-glow:rgba(239,68,68,0.3);
  --gold:#fbbf24;--gold-glow:rgba(251,191,36,0.3);
  --silver:#94a3b8;--bronze:#cd7f32;
  --text:#e2e8f0;--text2:#94a3b8;--text3:#475569;
  --font-display:'Orbitron',monospace;--font-body:'Inter',sans-serif;
  --r:16px;--r-sm:10px;--r-xs:6px;
  --nav-h:68px;--safe-b:env(safe-area-inset-bottom,0px);
  --transition:all .25s cubic-bezier(.4,0,.2,1);
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{-webkit-tap-highlight-color:transparent;scroll-behavior:smooth}
body{font-family:var(--font-body);background:var(--bg);color:var(--text);
  min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased;
  padding-bottom:calc(var(--nav-h) + var(--safe-b) + 16px)}

/* ‚ïê‚ïê‚ïê BG CANVAS ‚ïê‚ïê‚ïê */
#bgCanvas{position:fixed;inset:0;z-index:0;pointer-events:none}
.bg-grid{position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:linear-gradient(rgba(0,240,255,0.03) 1px,transparent 1px),
  linear-gradient(90deg,rgba(0,240,255,0.03) 1px,transparent 1px);
  background-size:60px 60px}
.bg-glow{position:fixed;border-radius:50%;filter:blur(150px);pointer-events:none;z-index:0}
.bg-glow-1{width:500px;height:500px;background:var(--purple-dim);top:-150px;left:-150px;animation:floatOrb 15s ease-in-out infinite}
.bg-glow-2{width:400px;height:400px;background:var(--neon-dim);bottom:-100px;right:-100px;animation:floatOrb 20s ease-in-out infinite reverse}
.bg-glow-3{width:300px;height:300px;background:var(--pink-glow);top:50%;left:50%;transform:translate(-50%,-50%);opacity:0.1;animation:floatOrb 25s ease-in-out infinite}
@keyframes floatOrb{0%,100%{transform:translate(0,0)}25%{transform:translate(30px,-20px)}50%{transform:translate(-20px,30px)}75%{transform:translate(20px,10px)}}

/* ‚ïê‚ïê‚ïê SCAN LINE ‚ïê‚ïê‚ïê */
.scan-line{position:fixed;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--neon),transparent);
  z-index:999;opacity:0.15;animation:scanDown 8s linear infinite;pointer-events:none}
@keyframes scanDown{from{top:-2px}to{top:100vh}}

/* ‚ïê‚ïê‚ïê APP CONTAINER ‚ïê‚ïê‚ïê */
.app{position:relative;z-index:1;max-width:480px;margin:0 auto;padding:12px 14px 20px}

/* ‚ïê‚ïê‚ïê PAGES ‚ïê‚ïê‚ïê */
.page{display:none;opacity:0;transform:translateY(12px)}.page.active{display:block;animation:pageIn .35s ease forwards}
@keyframes pageIn{to{opacity:1;transform:translateY(0)}}

/* ‚ïê‚ïê‚ïê GLASSMORPHISM CARD ‚ïê‚ïê‚ïê */
.g-card{background:var(--surface);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  border:1px solid var(--glass-border);border-radius:var(--r);padding:20px;margin-bottom:14px;
  transition:var(--transition);position:relative;overflow:hidden}
.g-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--neon-dim),transparent)}
.g-card:hover{border-color:rgba(0,240,255,0.15);box-shadow:0 0 30px rgba(0,240,255,0.05)}
.g-card:active{transform:scale(0.985)}

/* ‚ïê‚ïê‚ïê NEON TITLE ‚ïê‚ïê‚ïê */
.neon-title{font-family:var(--font-display);font-weight:800;font-size:22px;
  background:linear-gradient(135deg,var(--neon),var(--purple));-webkit-background-clip:text;
  -webkit-text-fill-color:transparent;text-shadow:0 0 40px var(--neon-glow);letter-spacing:1px}
.neon-sub{font-size:13px;color:var(--text2);margin-top:2px;letter-spacing:0.5px}

/* ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê */
.page-header{display:flex;align-items:center;gap:12px;margin-bottom:18px;padding:8px 0}
.page-header .icon-box{width:46px;height:46px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:20px;
  border:1px solid var(--glass-border);position:relative;overflow:hidden}
.page-header .icon-box::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,var(--neon-dim),transparent);opacity:0.5}
.page-header h2{font-family:var(--font-display);font-size:16px;font-weight:700;letter-spacing:1px}
.page-header .sub{font-size:12px;color:var(--text2)}

/* ‚ïê‚ïê‚ïê BUTTONS ‚ïê‚ïê‚ïê */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 24px;
  border-radius:var(--r-sm);font-family:var(--font-body);font-weight:600;font-size:14px;
  cursor:pointer;border:none;transition:var(--transition);text-decoration:none;position:relative;overflow:hidden}
.btn::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.1),transparent);opacity:0;transition:opacity .2s}
.btn:hover::before{opacity:1}
.btn:active{transform:scale(0.96)}
.btn-neon{background:linear-gradient(135deg,var(--neon),#0099ff);color:#000;font-weight:700;
  box-shadow:0 0 20px var(--neon-glow),inset 0 1px 0 rgba(255,255,255,0.2)}
.btn-purple{background:linear-gradient(135deg,var(--purple),#7c3aed);color:#fff;
  box-shadow:0 0 20px var(--purple-glow)}
.btn-ghost{background:var(--glass2);border:1px solid var(--glass-border);color:var(--text)}
.btn-ghost:hover{border-color:var(--neon);color:var(--neon)}
.btn-sm{padding:8px 14px;font-size:12px}
.btn-block{width:100%}
.btn-success{background:linear-gradient(135deg,var(--green),#059669);color:#fff}
.btn-danger{background:linear-gradient(135deg,var(--red),#dc2626);color:#fff}

/* ‚ïê‚ïê‚ïê PROGRESS BAR ‚ïê‚ïê‚ïê */
.xp-bar{width:100%;height:6px;background:var(--glass);border-radius:3px;overflow:hidden;position:relative}
.xp-bar .fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--neon),var(--purple));
  transition:width .8s cubic-bezier(.4,0,.2,1);position:relative}
.xp-bar .fill::after{content:'';position:absolute;right:0;top:0;bottom:0;width:20px;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4));animation:shimmer 2s infinite}
@keyframes shimmer{0%{opacity:0}50%{opacity:1}100%{opacity:0}}

/* ‚ïê‚ïê‚ïê AVATAR ‚ïê‚ïê‚ïê */
.avatar{border-radius:50%;border:2px solid var(--neon);box-shadow:0 0 15px var(--neon-glow);transition:var(--transition)}
.avatar:hover{box-shadow:0 0 25px var(--neon-glow);transform:scale(1.05)}

/* ‚ïê‚ïê‚ïê USER ROW ‚ïê‚ïê‚ïê */
.user-row{display:flex;align-items:center;gap:14px}
.user-row .info{flex:1}
.user-row .name{font-family:var(--font-display);font-weight:700;font-size:15px;letter-spacing:0.5px}
.user-row .rank{font-size:12px;color:var(--neon);margin-top:1px}
.user-row .xp-info{font-size:11px;color:var(--text2);margin-top:3px}

/* ‚ïê‚ïê‚ïê STATS GRID ‚ïê‚ïê‚ïê */
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:12px 0}
.stat-box{text-align:center;padding:14px 6px;background:var(--glass);border:1px solid var(--glass-border);
  border-radius:var(--r-sm);transition:var(--transition)}
.stat-box:hover{border-color:var(--neon-dim);box-shadow:0 0 15px rgba(0,240,255,0.05)}
.stat-val{font-family:var(--font-display);font-size:20px;font-weight:800;color:var(--neon)}
.stat-label{font-size:10px;color:var(--text3);margin-top:3px;text-transform:uppercase;letter-spacing:1px}

/* ‚ïê‚ïê‚ïê COURSE CARD ‚ïê‚ïê‚ïê */
.course-card{cursor:pointer;padding:20px;position:relative}
.course-card:hover{border-color:var(--neon-dim)}
.course-card .tag{position:absolute;top:14px;right:14px;font-size:10px;font-family:var(--font-display);
  padding:4px 10px;border-radius:20px;font-weight:700;letter-spacing:1px}
.tag-basic{background:var(--neon-dim);color:var(--neon);border:1px solid rgba(0,240,255,0.2)}
.tag-pro{background:var(--purple-dim);color:var(--purple);border:1px solid rgba(168,85,247,0.2)}
.course-card .emoji{font-size:32px;margin-bottom:8px}
.course-card .title{font-family:var(--font-display);font-size:14px;font-weight:700;letter-spacing:0.5px;margin-bottom:4px}
.course-card .sub{font-size:12px;color:var(--text2)}
.course-card .prog{margin-top:10px}
.course-card .prog-text{font-size:11px;color:var(--text2);margin-bottom:4px;display:flex;justify-content:space-between}

/* ‚ïê‚ïê‚ïê LESSON GRID ‚ïê‚ïê‚ïê */
.lesson-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.lesson-tile{background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--r-sm);
  padding:16px 12px;text-align:center;cursor:pointer;transition:var(--transition);position:relative}
.lesson-tile:hover{border-color:var(--neon);box-shadow:0 0 20px rgba(0,240,255,0.08);transform:translateY(-2px)}
.lesson-tile.done{border-color:var(--green)}
.lesson-tile.done::after{content:'‚úì';position:absolute;top:6px;right:8px;color:var(--green);font-weight:800;font-size:12px;
  text-shadow:0 0 8px var(--green-glow)}
.lesson-tile .n{font-family:var(--font-display);font-size:28px;font-weight:900;
  background:linear-gradient(180deg,var(--neon),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:4px}
.lesson-tile .t{font-size:11px;color:var(--text2);line-height:1.3}

/* ‚ïê‚ïê‚ïê LESSON VIEW ‚ïê‚ïê‚ïê */
.lesson-body{font-size:14px;color:var(--text2);line-height:1.9;white-space:pre-line}
.video-wrap{width:100%;aspect-ratio:16/9;border-radius:var(--r);background:var(--glass);
  border:1px solid var(--glass-border);margin-bottom:16px;display:flex;align-items:center;justify-content:center;
  position:relative;overflow:hidden}
.video-wrap::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,var(--neon-dim),var(--purple-dim));opacity:0.3}
.video-wrap i{font-size:36px;color:var(--neon);position:relative;z-index:1;text-shadow:0 0 20px var(--neon-glow)}
.lesson-nav{display:flex;justify-content:space-between;gap:10px;margin-top:16px}

/* ‚ïê‚ïê‚ïê QUIZ ‚ïê‚ïê‚ïê */
.quiz-dots{display:flex;gap:6px;justify-content:center;margin-bottom:14px}
.q-dot{width:10px;height:10px;border-radius:50%;background:var(--glass);border:1px solid var(--glass-border);transition:var(--transition)}
.q-dot.now{background:var(--neon);border-color:var(--neon);box-shadow:0 0 10px var(--neon-glow)}
.q-dot.ok{background:var(--green);border-color:var(--green)}
.q-dot.bad{background:var(--red);border-color:var(--red)}
.quiz-q{font-size:17px;font-weight:700;margin-bottom:16px;line-height:1.45}
.quiz-opt{background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--r-sm);
  padding:14px 16px;margin-bottom:10px;cursor:pointer;font-size:14px;transition:var(--transition);
  position:relative;overflow:hidden}
.quiz-opt::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:transparent;transition:var(--transition)}
.quiz-opt:hover{border-color:var(--neon);background:var(--glass2)}.quiz-opt:hover::before{background:var(--neon)}
.quiz-opt.correct{border-color:var(--green);background:rgba(16,185,129,0.08);color:var(--green)}.quiz-opt.correct::before{background:var(--green)}
.quiz-opt.wrong{border-color:var(--red);background:rgba(239,68,68,0.08);color:var(--red)}.quiz-opt.wrong::before{background:var(--red)}
.quiz-explain{background:rgba(168,85,247,0.08);border:1px solid var(--purple);border-radius:var(--r-sm);padding:14px;margin-top:12px;font-size:13px;color:var(--text2);display:none}

/* ‚ïê‚ïê‚ïê AI CHAT ‚ïê‚ïê‚ïê */
.ai-container{display:flex;flex-direction:column;height:calc(100vh - var(--nav-h) - 60px)}
.ai-msgs{flex:1;overflow-y:auto;padding:8px 0;display:flex;flex-direction:column;gap:12px}
.ai-bubble{max-width:88%;padding:13px 16px;border-radius:var(--r-sm);font-size:14px;line-height:1.65;animation:pageIn .3s ease forwards}
.ai-bubble.user{align-self:flex-end;background:linear-gradient(135deg,var(--purple),#7c3aed);
  color:#fff;border-bottom-right-radius:4px;box-shadow:0 4px 15px var(--purple-glow)}
.ai-bubble.bot{align-self:flex-start;background:var(--surface);border:1px solid var(--glass-border);border-bottom-left-radius:4px}
.ai-bubble .src{font-size:11px;color:var(--text3);margin-top:8px;padding-top:8px;border-top:1px solid var(--glass-border)}
.ai-bubble .actions{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap}
.ai-bubble .a-btn{background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--r-xs);
  padding:4px 10px;cursor:pointer;font-size:11px;color:var(--text2);transition:var(--transition)}
.ai-bubble .a-btn:hover{border-color:var(--neon);color:var(--neon)}
.ai-bubble .a-btn.rated{border-color:var(--green);color:var(--green)}
.ai-bubble h2,.ai-bubble h3{font-family:var(--font-display);color:var(--neon);margin:12px 0 6px;font-size:15px;font-weight:700}
.ai-bubble h2:first-child,.ai-bubble h3:first-child{margin-top:0}
.ai-bubble p{margin:6px 0}
.ai-bubble ul,.ai-bubble ol{margin:6px 0 6px 18px;padding:0}
.ai-bubble li{margin:3px 0}
.ai-bubble strong{color:#e2e8f0;font-weight:700}
.ai-bubble em{color:var(--text2);font-style:italic}
.ai-bubble code{background:rgba(110,86,207,.25);padding:1px 5px;border-radius:4px;font-size:12px;color:var(--neon)}
.ai-bubble pre{background:rgba(0,0,0,.35);border:1px solid var(--glass-border);border-radius:var(--r-xs);padding:10px;margin:8px 0;overflow-x:auto}
.ai-bubble pre code{background:none;padding:0;font-size:12px;color:var(--text1)}
.ai-bubble hr{border:none;border-top:1px solid var(--glass-border);margin:10px 0}
.ai-bubble blockquote{border-left:3px solid var(--neon);margin:8px 0;padding:4px 12px;color:var(--text2);font-style:italic}
.ai-typing{align-self:flex-start;padding:12px 16px;background:var(--surface);border:1px solid var(--glass-border);border-radius:var(--r-sm);display:none}
.typing-dots{display:flex;gap:5px}
.typing-dots span{width:6px;height:6px;border-radius:50%;background:var(--neon);animation:bounce .6s infinite alternate}
.typing-dots span:nth-child(2){animation-delay:.15s}.typing-dots span:nth-child(3){animation-delay:.3s}
@keyframes bounce{to{opacity:.2;transform:translateY(-5px)}}
.ai-bar{display:flex;gap:8px;padding:12px 0;border-top:1px solid var(--glass-border)}
.ai-textarea{flex:1;background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--r-sm);
  padding:12px 16px;color:var(--text);font-family:var(--font-body);font-size:14px;resize:none;outline:none;transition:var(--transition)}
.ai-textarea:focus{border-color:var(--neon);box-shadow:0 0 15px rgba(0,240,255,0.08)}
.ai-send{width:46px;height:46px;border-radius:var(--r-sm);background:linear-gradient(135deg,var(--neon),#0099ff);
  color:#000;border:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;
  transition:var(--transition);box-shadow:0 0 15px var(--neon-glow)}
.ai-send:hover{transform:scale(1.05)}.ai-send:disabled{opacity:.4;cursor:not-allowed;transform:none}
.quick-qs{display:flex;flex-wrap:wrap;gap:6px;margin:8px 0}
.quick-q{background:var(--glass);border:1px solid var(--glass-border);border-radius:20px;
  padding:7px 14px;font-size:12px;color:var(--text2);cursor:pointer;transition:var(--transition)}
.quick-q:hover{border-color:var(--neon);color:var(--neon);box-shadow:0 0 10px rgba(0,240,255,0.1)}

/* ‚ïê‚ïê‚ïê ACCOUNTANT ‚ïê‚ïê‚ïê */
.acc-widget{background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1px solid var(--glass-border);
  border-radius:var(--r);padding:20px;text-align:center;margin-bottom:14px;position:relative;overflow:hidden}
.acc-widget::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--green),transparent)}
.acc-widget .val{font-family:var(--font-display);font-size:30px;font-weight:900;color:var(--green);
  text-shadow:0 0 20px var(--green-glow);margin:4px 0}
.acc-widget .lbl{font-size:12px;color:var(--text3);text-transform:uppercase;letter-spacing:2px}
.exchange-card{display:flex;align-items:center;gap:12px;padding:14px;background:var(--glass);
  border:1px solid var(--glass-border);border-radius:var(--r-sm);margin-bottom:8px;cursor:pointer;transition:var(--transition)}
.exchange-card:hover{border-color:var(--gold);box-shadow:0 0 15px var(--gold-glow)}
.exchange-card .ex-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;
  justify-content:center;font-size:20px;background:var(--glass2);border:1px solid var(--glass-border)}
.exchange-card .ex-name{font-weight:700;font-size:14px}.exchange-card .ex-status{font-size:11px;color:var(--text3)}
.exchange-card .ex-badge{margin-left:auto;font-size:11px;padding:3px 10px;border-radius:20px;font-weight:600}
.ex-connected{background:rgba(16,185,129,0.1);color:var(--green);border:1px solid rgba(16,185,129,0.2)}
.ex-disconnected{background:rgba(239,68,68,0.1);color:var(--red);border:1px solid rgba(239,68,68,0.2)}
/* Merchant Badge */
.merchant-badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:12px;
  background:linear-gradient(135deg,rgba(251,191,36,0.15),rgba(245,158,11,0.08));
  border:1px solid rgba(251,191,36,0.3);font-size:10px;font-weight:700;color:var(--gold);
  font-family:var(--font-display);letter-spacing:0.5px;vertical-align:middle;
  animation:merchantPulse 3s ease-in-out infinite}
.merchant-badge svg{width:14px;height:14px;filter:drop-shadow(0 0 4px rgba(251,191,36,0.6))}
@keyframes merchantPulse{0%,100%{box-shadow:0 0 8px rgba(251,191,36,0.1)}50%{box-shadow:0 0 16px rgba(251,191,36,0.3)}}
.merchant-badge-sm{display:inline-flex;align-items:center;gap:2px;vertical-align:middle}
.merchant-badge-sm svg{width:12px;height:12px;filter:drop-shadow(0 0 3px rgba(251,191,36,0.5))}
/* Spread table */
.spread-tbl{width:100%;border-collapse:collapse;font-size:11px}
.spread-tbl th{padding:6px 4px;text-align:center;color:var(--text3);font-size:10px;font-family:var(--font-display);
  letter-spacing:0.5px;border-bottom:1px solid var(--glass-border)}
.spread-tbl td{padding:6px 4px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.03)}
.spread-tbl tr:hover td{background:var(--glass)}
/* Date picker */
.date-input{background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--r-xs);
  padding:8px 10px;color:var(--text);font-family:var(--font-body);font-size:12px;outline:none;
  transition:var(--transition);width:100%}
.date-input:focus{border-color:var(--neon);box-shadow:0 0 10px rgba(0,240,255,0.1)}
/* Today stats */
.today-stat{display:flex;align-items:center;gap:8px;padding:8px 10px;background:var(--glass);
  border-radius:var(--r-xs);margin-bottom:6px;font-size:12px}
.today-stat .ts-icon{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;
  font-size:14px;flex-shrink:0}
.today-stat .ts-label{color:var(--text3);font-size:10px}.today-stat .ts-val{font-weight:700;font-family:var(--font-display);font-size:13px}

/* ‚ïê‚ïê‚ïê LEADERBOARD ‚ïê‚ïê‚ïê */
.podium{display:flex;align-items:flex-end;justify-content:center;gap:8px;margin:20px 0 16px}
.pod{text-align:center;border-radius:var(--r) var(--r) 0 0;padding:14px 8px;position:relative}
.pod .medal{font-size:22px;margin-bottom:4px;filter:drop-shadow(0 0 8px currentColor)}
.pod img{width:42px;height:42px;border-radius:50%;margin-bottom:6px}
.pod .p-name{font-size:11px;font-weight:600;margin-bottom:2px}.pod .p-xp{font-size:10px;color:var(--text2)}
.pod-1{min-height:130px;width:95px;background:linear-gradient(180deg,rgba(251,191,36,0.12),transparent);border:1px solid rgba(251,191,36,0.15)}
.pod-2{min-height:100px;width:82px;background:linear-gradient(180deg,rgba(148,163,184,0.1),transparent);border:1px solid rgba(148,163,184,0.1)}
.pod-3{min-height:82px;width:82px;background:linear-gradient(180deg,rgba(205,127,50,0.1),transparent);border:1px solid rgba(205,127,50,0.1)}
.lb-row{display:flex;align-items:center;gap:12px;padding:12px;border-bottom:1px solid var(--glass-border);transition:var(--transition)}
.lb-row:hover{background:var(--glass)}.lb-row.me{background:rgba(0,240,255,0.04);border-left:3px solid var(--neon)}
.lb-pos{width:28px;font-family:var(--font-display);font-weight:800;color:var(--text3);font-size:14px}
.lb-row img{width:36px;height:36px;border-radius:50%}
.lb-info{flex:1}.lb-name{font-weight:600;font-size:13px}.lb-rank{font-size:11px;color:var(--text2)}
.lb-xp{font-family:var(--font-display);font-weight:700;font-size:14px;color:var(--neon)}

/* ‚ïê‚ïê‚ïê ACHIEVEMENTS ‚ïê‚ïê‚ïê */
.ach-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.ach{text-align:center;padding:18px 8px;background:var(--glass);border:1px solid var(--glass-border);
  border-radius:var(--r-sm);cursor:pointer;transition:var(--transition);position:relative;overflow:hidden}
.ach:hover{border-color:var(--purple);transform:translateY(-2px)}
.ach.earned{border-color:var(--neon);box-shadow:0 0 20px rgba(0,240,255,0.1)}
.ach.earned::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(0,240,255,0.05),transparent)}
.ach.locked{opacity:.35;filter:grayscale(.8)}
.ach .emoji{font-size:30px;margin-bottom:6px;display:block}
.ach .a-title{font-size:10px;color:var(--text2);line-height:1.3}

/* ‚ïê‚ïê‚ïê FAQ ‚ïê‚ïê‚ïê */
.faq{background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--r-sm);margin-bottom:8px;overflow:hidden}
.faq-q{padding:14px 16px;font-weight:600;font-size:14px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.faq-q::after{content:'‚ñ∏';color:var(--text3);transition:transform .2s}.faq.open .faq-q::after{transform:rotate(90deg);color:var(--neon)}
.faq-a{padding:0 16px 14px;font-size:13px;color:var(--text2);line-height:1.65;display:none}.faq.open .faq-a{display:block}

/* ‚ïê‚ïê‚ïê PROFILE ‚ïê‚ïê‚ïê */
.profile-top{text-align:center;padding:24px 0 16px;position:relative}
.profile-top .avatar{width:86px;height:86px;margin:0 auto 12px;display:block}
.profile-top .name{font-family:var(--font-display);font-size:20px;font-weight:800;letter-spacing:1px}
.profile-top .rank{color:var(--neon);font-size:13px;margin-top:3px;font-family:var(--font-display);letter-spacing:0.5px}
.profile-top .plan-badge{display:inline-block;margin-top:8px;font-size:11px;font-family:var(--font-display);
  padding:4px 14px;border-radius:20px;font-weight:700;letter-spacing:1px}

/* ‚ïê‚ïê‚ïê SETTINGS ‚ïê‚ïê‚ïê */
.set-row{display:flex;align-items:center;justify-content:space-between;padding:16px;background:var(--glass);
  border:1px solid var(--glass-border);border-radius:var(--r-sm);margin-bottom:8px}
.set-row .lbl{font-weight:600;font-size:14px}.set-row .desc{font-size:12px;color:var(--text2)}
.toggle{width:48px;height:28px;border-radius:14px;background:var(--glass2);border:1px solid var(--glass-border);
  position:relative;cursor:pointer;transition:var(--transition)}
.toggle.on{background:var(--neon);border-color:var(--neon)}
.toggle::after{content:'';width:22px;height:22px;border-radius:50%;background:#fff;
  position:absolute;top:2px;left:2px;transition:var(--transition);box-shadow:0 2px 5px rgba(0,0,0,.3)}
.toggle.on::after{left:22px}

/* ‚ïê‚ïê‚ïê REFERRAL ‚ïê‚ïê‚ïê */
.ref-card{background:linear-gradient(135deg,rgba(168,85,247,0.12),rgba(0,240,255,0.06));
  border:1px solid var(--glass-border);border-radius:var(--r);padding:20px;text-align:center;position:relative;overflow:hidden}
.ref-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--purple),transparent)}
.ref-count{font-family:var(--font-display);font-size:40px;font-weight:900;color:var(--purple);
  text-shadow:0 0 20px var(--purple-glow)}
.ref-link-row{display:flex;gap:6px;margin-top:12px}
.ref-input{flex:1;background:var(--glass);border:1px solid var(--glass-border);
  border-radius:var(--r-sm);padding:10px;color:var(--neon);font-size:11px;font-family:monospace}
.ref-copy{padding:10px 16px;background:var(--glass2);border:1px solid var(--glass-border);
  border-radius:var(--r-sm);color:var(--text);cursor:pointer;font-weight:600;font-size:12px;transition:var(--transition)}
.ref-copy:hover{border-color:var(--neon);color:var(--neon)}

/* ‚ïê‚ïê‚ïê ADMIN ‚ïê‚ïê‚ïê */
.admin-stat{display:flex;gap:10px;margin-bottom:14px;overflow-x:auto;padding-bottom:4px}
.admin-stat .a-box{flex:0 0 auto;min-width:100px;padding:14px;background:var(--glass);border:1px solid var(--glass-border);
  border-radius:var(--r-sm);text-align:center}
.a-box .a-val{font-family:var(--font-display);font-size:22px;font-weight:800;color:var(--neon)}
.a-box .a-lbl{font-size:10px;color:var(--text3);margin-top:2px;text-transform:uppercase;letter-spacing:1px}
.admin-list .al-item{display:flex;align-items:center;gap:10px;padding:12px;border-bottom:1px solid var(--glass-border)}
.al-item .al-info{flex:1}.al-item .al-name{font-weight:600;font-size:13px}.al-item .al-sub{font-size:11px;color:var(--text2)}
.al-item .al-badge{font-size:10px;padding:3px 10px;border-radius:12px;font-weight:600}

/* ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê */
.toast{position:fixed;top:16px;left:50%;transform:translateX(-50%);background:var(--surface);
  backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--r-sm);
  padding:12px 22px;font-size:14px;font-weight:600;z-index:1000;
  box-shadow:0 8px 40px rgba(0,0,0,.5);animation:toastIn .4s ease;max-width:90%}
.toast.success{border-color:var(--green);color:var(--green)}.toast.error{border-color:var(--red);color:var(--red)}
.toast.info{border-color:var(--neon);color:var(--neon)}.toast.warning{border-color:var(--gold);color:var(--gold)}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(-20px) scale(.95)}to{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}}

/* ‚ïê‚ïê‚ïê CONFETTI BURST XP ‚ïê‚ïê‚ïê */
.xp-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-family:var(--font-display);
  font-size:36px;font-weight:900;color:var(--neon);text-shadow:0 0 30px var(--neon-glow);z-index:999;
  animation:xpBurst .8s ease forwards;pointer-events:none}
@keyframes xpBurst{0%{opacity:0;transform:translate(-50%,-50%) scale(.5)}30%{opacity:1;transform:translate(-50%,-50%) scale(1.2)}
  60%{transform:translate(-50%,-50%) scale(1)}100%{opacity:0;transform:translate(-50%,-70%) scale(.8)}}

/* ‚ïê‚ïê‚ïê CHALLENGE ‚ïê‚ïê‚ïê */
.challenge{background:linear-gradient(135deg,rgba(251,191,36,0.06),rgba(168,85,247,0.04));
  border:1px solid var(--glass-border);position:relative;overflow:hidden}
.challenge::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--gold),transparent)}

/* ‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê */
.modal-overlay{position:fixed;inset:0;background:rgba(6,6,18,0.85);backdrop-filter:blur(8px);z-index:500;
  display:none;align-items:center;justify-content:center;padding:20px}
.modal-overlay.show{display:flex}
.modal-box{background:var(--surface);backdrop-filter:blur(30px);border:1px solid var(--glass-border);
  border-radius:var(--r);padding:28px;max-width:400px;width:100%;position:relative;animation:pageIn .3s ease forwards}
.modal-close{position:absolute;top:12px;right:14px;background:none;border:none;color:var(--text3);font-size:20px;cursor:pointer}

/* ‚ïê‚ïê‚ïê BOTTOM NAV ‚ïê‚ïê‚ïê */
.nav{position:fixed;bottom:0;left:0;right:0;height:var(--nav-h);background:rgba(6,6,18,0.95);
  backdrop-filter:blur(20px);border-top:1px solid var(--glass-border);display:flex;
  justify-content:space-around;align-items:center;z-index:100;padding-bottom:var(--safe-b)}
.nav-btn{display:flex;flex-direction:column;align-items:center;gap:3px;padding:8px 2px;cursor:pointer;
  color:var(--text3);transition:var(--transition);position:relative;font-size:10px;min-width:52px}
.nav-btn i{font-size:20px;transition:var(--transition)}
.nav-btn.active{color:var(--neon)}
.nav-btn.active i{filter:drop-shadow(0 0 8px var(--neon-glow))}
.nav-btn.active::before{content:'';position:absolute;top:0;left:25%;right:25%;height:2px;
  background:var(--neon);border-radius:0 0 2px 2px;box-shadow:0 0 10px var(--neon-glow)}

/* ‚ïê‚ïê‚ïê BACK BTN ‚ïê‚ïê‚ïê */
.back{display:inline-flex;align-items:center;gap:6px;color:var(--text2);cursor:pointer;font-size:13px;padding:6px 0;margin-bottom:10px;transition:var(--transition)}
.back:hover{color:var(--neon)}

/* ‚ïê‚ïê‚ïê GRID ‚ïê‚ïê‚ïê */
.g2{display:grid;grid-template-columns:1fr 1fr;gap:10px}

/* ‚ïê‚ïê‚ïê PULSE ANIMATION ‚ïê‚ïê‚ïê */
.pulse{animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}

/* ‚ïê‚ïê‚ïê SCROLLBAR ‚ïê‚ïê‚ïê */
::-webkit-scrollbar{width:3px}::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--glass-border);border-radius:2px}

/* ‚ïê‚ïê‚ïê LOADING ‚ïê‚ïê‚ïê */
.spinner{width:40px;height:40px;border:3px solid var(--glass-border);border-top-color:var(--neon);
  border-radius:50%;animation:spin .7s linear infinite;margin:40px auto}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-screen{position:fixed;inset:0;background:var(--bg);z-index:9999;display:flex;flex-direction:column;
  align-items:center;justify-content:center;transition:opacity .5s}
.loading-screen.hide{opacity:0;pointer-events:none}
.loading-logo{font-family:var(--font-display);font-size:28px;font-weight:900;
  background:linear-gradient(135deg,var(--neon),var(--purple));-webkit-background-clip:text;
  -webkit-text-fill-color:transparent;margin-bottom:20px;animation:pulse 1.5s ease-in-out infinite}
</style>
</head>
<body>

<!-- LOADING SCREEN -->
<div class="loading-screen" id="loadingScreen">
  <div class="loading-logo">SMILSKIY P2P</div>
  <div class="spinner"></div>
  <div style="font-size:12px;color:var(--text3);margin-top:14px;font-family:var(--font-display);letter-spacing:2px">LOADING SYSTEM...</div>
</div>

<!-- BG EFFECTS -->
<canvas id="bgCanvas"></canvas>
<div class="bg-grid"></div>
<div class="bg-glow bg-glow-1"></div>
<div class="bg-glow bg-glow-2"></div>
<div class="bg-glow bg-glow-3"></div>
<div class="scan-line"></div>

<div class="app">

<!-- ========== HOME ========== -->
<div id="p-home" class="page active">
  <div style="text-align:center;padding:18px 0 10px">
    <div class="neon-title">SMILSKIY P2P</div>
    <div class="neon-sub">CRYPTO ARBITRAGE ACADEMY</div>
  </div>
  <div class="g-card" id="homeUser">
    <div class="user-row">
      <img class="avatar" width="52" height="52" src="" alt="">
      <div class="info">
        <div class="name">...</div>
        <div class="rank"></div>
        <div class="xp-info"></div>
        <div class="xp-bar" style="margin-top:5px"><div class="fill" style="width:0%"></div></div>
      </div>
    </div>
  </div>
  <div id="homeCourses"></div>
  <div class="g-card challenge" id="homeChallenge"></div>
  <div class="g-card" id="homeTip">
    <div class="page-header" style="margin-bottom:10px">
      <div class="icon-box" style="color:var(--gold)">üí°</div>
      <div><h2 style="font-size:13px">–°–ò–ì–ù–ê–õ –î–ù–Ø</h2></div>
    </div>
    <div id="tipText" style="font-size:13px;color:var(--text2);line-height:1.6"></div>
    <div id="factText" style="font-size:12px;color:var(--text3);margin-top:8px;line-height:1.5;padding-top:8px;border-top:1px solid var(--glass-border)"></div>
  </div>
</div>

<!-- ========== COURSE ========== -->
<div id="p-course" class="page">
  <div class="back" onclick="App.go('home')"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</div>
  <h2 id="courseTitle" style="font-family:var(--font-display);font-size:18px;font-weight:800;letter-spacing:1px;margin-bottom:4px"></h2>
  <p id="courseSub" style="font-size:12px;color:var(--text2);margin-bottom:14px"></p>
  <div class="xp-bar" style="margin-bottom:16px"><div id="courseFill" class="fill" style="width:0%"></div></div>
  <div class="g2" style="margin-bottom:14px">
    <button class="btn btn-ghost btn-sm" onclick="App.modules.courses.materials()"><i class="fas fa-folder-open"></i> –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</button>
    <button class="btn btn-ghost btn-sm" onclick="App.go('home')"><i class="fas fa-home"></i> –ì–æ–ª–æ–≤–Ω–∞</button>
  </div>
  <div id="lessonGrid" class="lesson-grid"></div>
</div>

<!-- ========== LESSON ========== -->
<div id="p-lesson" class="page">
  <div class="back" onclick="App.modules.courses.backToCourse()"><i class="fas fa-arrow-left"></i> –î–æ –∫—É—Ä—Å—É</div>
  <h2 id="lessonTitle" style="font-family:var(--font-display);font-size:15px;font-weight:700;letter-spacing:0.5px;margin-bottom:14px"></h2>
  <div id="lessonVideo"></div>
  <div class="g-card"><div id="lessonBody" class="lesson-body"></div></div>
  <div id="lessonQuizBtn" style="margin:14px 0"></div>
  <div id="lessonNav" class="lesson-nav"></div>
</div>

<!-- ========== QUIZ ========== -->
<div id="p-quiz" class="page">
  <div class="back" onclick="App.modules.quizzes.backToLesson()"><i class="fas fa-arrow-left"></i> –î–æ —É—Ä–æ–∫—É</div>
  <div id="quizDots" class="quiz-dots"></div>
  <div class="g-card">
    <div id="quizQ" class="quiz-q"></div>
    <div id="quizOpts"></div>
  </div>
  <div id="quizExplain" class="quiz-explain"></div>
</div>

<!-- ========== QUIZ RESULTS ========== -->
<div id="p-quizResults" class="page">
  <div id="quizResContent" style="text-align:center;padding:40px 0"></div>
</div>

<!-- ========== AI ========== -->
<div id="p-ai" class="page">
  <div class="ai-container">
    <div class="page-header" style="margin-bottom:6px">
      <div class="icon-box" style="color:var(--neon)">ü§ñ</div>
      <div><h2>AI ASSISTANT</h2><div class="sub">DeepSeek P2P Expert</div></div>
    </div>
    <div id="aiQuickQs" class="quick-qs">
      <div class="quick-q" onclick="App.modules.ai.quick(this)">–©–æ —Ç–∞–∫–µ P2P?</div>
      <div class="quick-q" onclick="App.modules.ai.quick(this)">–Ø–∫ –∑–∞—Ä–æ–±–∏—Ç–∏ –Ω–∞ —Å–ø—Ä–µ–¥—ñ?</div>
      <div class="quick-q" onclick="App.modules.ai.quick(this)">–Ø–∫ —É–Ω–∏–∫–Ω—É—Ç–∏ —Å–∫–∞–º—É?</div>
      <div class="quick-q" onclick="App.modules.ai.quick(this)">–°—Ç–∞—Ä—Ç–æ–≤–∏–π –∫–∞–ø—ñ—Ç–∞–ª?</div>
    </div>
    <div id="aiMsgs" class="ai-msgs">
      <div class="ai-bubble bot">–ü—Ä–∏–≤—ñ—Ç! –Ø AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç Smilskiy P2P Academy. –ó–∞–ø–∏—Ç—É–π –±—É–¥—å-—â–æ –ø—Ä–æ –∫—Ä–∏–ø—Ç–æ-–∞—Ä–±—ñ—Ç—Ä–∞–∂! üöÄ</div>
    </div>
    <div id="aiTyping" class="ai-typing"><div class="typing-dots"><span></span><span></span><span></span></div></div>
    <div class="ai-bar">
      <textarea id="aiInput" class="ai-textarea" rows="1" placeholder="–ó–∞–ø–∏—Ç–∞–π –ø—Ä–æ P2P..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();App.modules.ai.send()}"></textarea>
      <button id="aiSendBtn" class="ai-send" onclick="App.modules.ai.send()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>
</div>

<!-- ========== ACCOUNTANT ========== -->
<div id="p-accountant" class="page">
  <div class="page-header">
    <div class="icon-box" style="color:var(--green)">üìä</div>
    <div><h2>–ë–£–•–ì–ê–õ–¢–ï–†</h2><div class="sub">Binance P2P –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞</div></div>
  </div>
  <div id="accountantContent">
    <div class="g-card" style="text-align:center"><div class="spinner"></div></div>
  </div>
</div>

<!-- ========== PROFILE ========== -->
<div id="p-profile" class="page">
  <div class="profile-top">
    <img id="profAvatar" class="avatar" width="86" height="86" src="" alt="">
    <div id="profName" class="name">–ì—Ä–∞–≤–µ—Ü—å</div>
    <div id="profRank" class="rank"></div>
    <div id="profPlan" class="plan-badge"></div>
  </div>
  <div class="g-card">
    <div class="xp-bar"><div id="profXpFill" class="fill" style="width:0%"></div></div>
    <p id="profXpText" style="font-size:11px;color:var(--text2);text-align:center;margin-top:5px"></p>
  </div>
  <div id="profStats" class="stats-grid"></div>
  <div class="g-card" id="profCourses"></div>
  <div class="g-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <h3 style="font-family:var(--font-display);font-size:13px;letter-spacing:1px">–î–û–°–Ø–ì–ù–ï–ù–ù–Ø</h3>
      <span style="font-size:12px;color:var(--neon);cursor:pointer" onclick="App.go('achievements')">–£—Å—ñ ‚Üí</span>
    </div>
    <div id="profAchs" class="ach-grid"></div>
  </div>
  <canvas id="profChart" style="margin:14px 0;max-height:180px"></canvas>
  <div class="g2" style="margin-top:10px">
    <button class="btn btn-ghost btn-sm btn-block" onclick="App.go('settings')"><i class="fas fa-cog"></i> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
    <button class="btn btn-ghost btn-sm btn-block" onclick="App.modules.profile.exportData()"><i class="fas fa-download"></i> –ï–∫—Å–ø–æ—Ä—Ç</button>
  </div>
</div>

<!-- ========== LEADERBOARD ========== -->
<div id="p-leaderboard" class="page">
  <div class="page-header">
    <div class="icon-box" style="color:var(--gold)">üèÜ</div>
    <div><h2>–†–ï–ô–¢–ò–ù–ì</h2><div class="sub" id="lbSeason">–°–µ–∑–æ–Ω 1</div></div>
  </div>
  <div id="lbPodium" class="podium"></div>
  <div class="g-card"><div id="lbList"></div></div>
</div>

<!-- ========== ACHIEVEMENTS ========== -->
<div id="p-achievements" class="page">
  <div class="back" onclick="App.go('profile')"><i class="fas fa-arrow-left"></i> –ü—Ä–æ—Ñ—ñ–ª—å</div>
  <div class="page-header" style="margin-bottom:4px">
    <div class="icon-box" style="color:var(--green)">üèÖ</div>
    <div><h2>–î–û–°–Ø–ì–ù–ï–ù–ù–Ø</h2><div class="sub" id="achCount">0/17</div></div>
  </div>
  <div id="achGrid" class="ach-grid"></div>
</div>

<!-- ========== SETTINGS ========== -->
<div id="p-settings" class="page">
  <div class="back" onclick="App.go('profile')"><i class="fas fa-arrow-left"></i> –ü—Ä–æ—Ñ—ñ–ª—å</div>
  <div class="page-header">
    <div class="icon-box" style="color:var(--purple)">‚öôÔ∏è</div>
    <div><h2>–ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø</h2></div>
  </div>
  <div class="set-row"><div><div class="lbl">–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è</div><div class="desc">–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ —É—Ä–æ–∫–∏</div></div>
    <div class="toggle" id="notifToggle" onclick="App.modules.settings.toggleNotif()"></div></div>
  <div class="set-row"><div><div class="lbl">–¢–µ–º–∞</div><div class="desc">Telegram –∞–≤—Ç–æ</div></div>
    <div style="font-size:12px;color:var(--text3);font-family:var(--font-display)">AUTO</div></div>
  <div class="g-card" style="margin-top:14px">
    <div style="font-family:var(--font-display);font-size:13px;letter-spacing:1px;margin-bottom:12px">REFERRAL PROGRAM</div>
    <div class="ref-card">
      <div style="font-size:12px;opacity:.7">–ó–∞–ø—Ä–æ—à–µ–Ω–æ –¥—Ä—É–∑—ñ–≤</div>
      <div class="ref-count" id="refCount">0</div>
      <div style="font-size:11px;color:var(--text2);margin-top:4px">+100 XP –∫–æ–∂–Ω–æ–º—É!</div>
      <div class="ref-link-row">
        <input type="text" id="refLink" class="ref-input" readonly>
        <button class="ref-copy" onclick="App.modules.referrals.copy()"><i class="fas fa-copy"></i></button>
      </div>
    </div>
  </div>
  <button class="btn btn-ghost btn-block" style="margin-top:14px" onclick="App.modules.profile.exportData()"><i class="fas fa-download"></i> –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö</button>
</div>

<!-- ========== ADMIN ========== -->
<div id="p-admin" class="page">
  <div class="page-header">
    <div class="icon-box" style="color:var(--red)">üõ°Ô∏è</div>
    <div><h2>ADMIN PANEL</h2><div class="sub">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ—é</div></div>
  </div>
  <div class="admin-stat" id="adminStats"></div>
  <div class="g-card">
    <h3 style="font-family:var(--font-display);font-size:13px;letter-spacing:1px;margin-bottom:12px">–ö–û–†–ò–°–¢–£–í–ê–ß–Ü</h3>
    <div id="adminUsers" class="admin-list"></div>
  </div>
  <div class="g-card">
    <h3 style="font-family:var(--font-display);font-size:13px;letter-spacing:1px;margin-bottom:12px">–î–Ü–á</h3>
    <div class="g2">
      <button class="btn btn-ghost btn-sm btn-block" onclick="App.modules.admin.broadcast()"><i class="fas fa-bullhorn"></i> –†–æ–∑—Å–∏–ª–∫–∞</button>
      <button class="btn btn-ghost btn-sm btn-block" onclick="App.modules.admin.grantAccess()"><i class="fas fa-key"></i> –î–æ—Å—Ç—É–ø</button>
    </div>
  </div>
</div>

</div><!-- end .app -->

<!-- MODAL -->
<div class="modal-overlay" id="modal">
  <div class="modal-box"><button class="modal-close" onclick="App.closeModal()">&times;</button><div id="modalBody"></div></div>
</div>

<!-- BOTTOM NAV -->
<div class="nav">
  <div class="nav-btn active" onclick="App.go('home')" data-p="home"><i class="fas fa-home"></i><span>Home</span></div>
  <div class="nav-btn" onclick="App.go('ai')" data-p="ai"><i class="fas fa-robot"></i><span>AI</span></div>
  <div class="nav-btn" onclick="App.go('accountant')" data-p="accountant"><i class="fas fa-chart-pie"></i><span>–ë—É—Ö–≥–∞–ª—Ç–µ—Ä</span></div>
  <div class="nav-btn" onclick="App.go('profile')" data-p="profile"><i class="fas fa-user"></i><span>–ü—Ä–æ—Ñ—ñ–ª—å</span></div>
  <div class="nav-btn" onclick="App.go('leaderboard')" data-p="leaderboard"><i class="fas fa-trophy"></i><span>–†–µ–π—Ç–∏–Ω–≥</span></div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SMILSKIY P2P ACADEMY ‚Äî MODULAR SPA
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const LESSONS={
1:{title:"P2P-–∞—Ä–±—ñ—Ç—Ä–∞–∂ ‚Äî —â–æ —Ü–µ —ñ —è–∫ –∑–∞—Ä–æ–±–ª—è—Ç–∏",short:"P2P: –≤—Å—Ç—É–ø",text:"–©–æ —Ç–∞–∫–µ P2P-–∞—Ä–±—ñ—Ç—Ä–∞–∂ —ñ —á–æ–º—É —Ü–µ ‚Äî –æ–¥–Ω–∞ –∑ –Ω–∞–π–ª–µ–≥—à–∏—Ö —Ç–æ—á–æ–∫ –≤—Ö–æ–¥—É –≤ –∫—Ä–∏–ø—Ç—É\n–†–µ–∞–ª—å–Ω–∏–π –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª: –≤—ñ–¥ $500 –¥–æ $10K+/–º—ñ—Å\n–©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è —Å—Ç–∞—Ä—Ç—É: –º—ñ–Ω—ñ–º—É–º –≤–∫–ª–∞–¥–µ–Ω—å, –º–∞–∫—Å–∏–º—É–º —Å–∏—Å—Ç–µ–º–Ω–æ—Å—Ç—ñ\n–û–±—Å—è–≥ –º–æ–¥—É–ª—è: 10 —É—Ä–æ–∫—ñ–≤, —â–æ –ø—Ä–æ–≤–µ–¥—É—Ç—å –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≤–ø–µ–≤–Ω–µ–Ω–æ–≥–æ –º–µ—Ä–∂—É",xp:50},
2:{title:"–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–∞ –±—ñ—Ä–∂—ñ: Binance, Bybit, OKX",short:"–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è",text:"–ü–æ–∫—Ä–æ–∫–æ–≤–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–∞ —Ç–æ–ø-–±—ñ—Ä–∂–∞—Ö (Binance, Bybit, OKX)\n–í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è KYC ‚Äî —â–æ —Ü–µ —Ç–∞ –Ω–∞–≤—ñ—â–æ\nP2P-—Ä–æ–∑–¥—ñ–ª: —è–∫ –∑–Ω–∞–π—Ç–∏, —è–∫ –æ—Ä—ñ—î–Ω—Ç—É–≤–∞—Ç–∏—Å—è\n–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é –ø—ñ–¥ P2P-—Ç–æ—Ä–≥—ñ–≤–ª—é",xp:50},
3:{title:"–ë–µ–∑–ø–µ–∫–∞ –∞–∫–∞—É–Ω—Ç—É —Ç–∞ 2FA",short:"–ë–µ–∑–ø–µ–∫–∞",text:"–ß–æ–º—É –ª–∞–º–∞—é—Ç—å —Ç—Ä–µ–π–¥–µ—Ä—ñ–≤ —ñ —è–∫ —Ü—å–æ–≥–æ —É–Ω–∏–∫–Ω—É—Ç–∏\n2FA (Google Authenticator / SMS / Email) ‚Äî —è–∫ —É–≤—ñ–º–∫–Ω—É—Ç–∏\n–ê–Ω—Ç–∏—Ñ—ñ—à–∏–Ω–≥-–∫–æ–¥: —â–æ —Ü–µ —ñ —è–∫ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏\n–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è seed-—Ñ—Ä–∞–∑–∏ —Ç–∞ –±–µ–∫–∞–ø—ñ–≤",xp:50},
4:{title:"–ü–µ—Ä—à–∞ —É–≥–æ–¥–∞: –ø–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è",short:"–ü–µ—Ä—à–∞ —É–≥–æ–¥–∞",text:"–Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–µ—Ä—à—É P2P-—É–≥–æ–¥—É (—ñ –Ω–µ –ø–æ–º–∏–ª–∏—Ç–∏—Å—è)\n–í–∏–±—ñ—Ä –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞: —Ä–µ–π—Ç–∏–Ω–≥, –æ–±'—î–º, –≤—ñ–¥–≥—É–∫–∏\n–©–æ –ø–∏—Å–∞—Ç–∏ –≤ —á–∞—Ç—ñ —É–≥–æ–¥–∏\n–ß–æ–º—É –Ω–µ –≤–∞—Ä—Ç–æ –ø–æ—Å–ø—ñ—à–∞—Ç–∏: –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–ø–ª–∞—Ç–∏\n–Ø–∫ ¬´–ø—Ä–æ–≥—Ä—ñ—Ç–∏¬ª –∞–∫–∞—É–Ω—Ç –¥–æ —Å—Ç–∞—Ç—É—Å—É –º–µ—Ä—á–∞–Ω—Ç–∞",xp:50},
5:{title:"–ë–∞–Ω–∫–∏ —É P2P: —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —Ç–∞ –ª—ñ–º—ñ—Ç–∏",short:"–ë–∞–Ω–∫–∏",text:"–Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –∫–∞—Ä—Ç–∫—É –±–µ–∑ –∑–∞–π–≤–∏—Ö –ø–∏—Ç–∞–Ω—å\n–Ø–∫—ñ –¥–∞–Ω—ñ –≤–∫–∞–∑—É–≤–∞—Ç–∏, —â–æ–± –æ–±—ñ–π—Ç–∏ –¥–æ–≤—ñ–¥–∫–∏\n–û—Å–Ω–æ–≤–Ω—ñ –ª—ñ–º—ñ—Ç–∏ —Ç–∞ –∫–æ–ª–∏ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î —Ñ—ñ–Ω–º–æ–Ω\n–ü—Ä–æ–≥—Ä—ñ–≤ –∫–∞—Ä—Ç–∫–∏: –æ–ø–ª–∞—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö, –∑–∞–ø—Ä–∞–≤–∫–∞—Ö, —Å–µ—Ä–≤—ñ—Å–∞—Ö",xp:50},
6:{title:"–°–∫–∞–º-—Å—Ö–µ–º–∏ —É P2P",short:"–°–∫–∞–º",text:"–ù–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏–π '—á–æ—Ä–Ω–∏–π —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫' —ñ —è–∫ –≤—ñ–Ω –ø—Ä–∞—Ü—é—î\n–ß–æ–º—É –Ω–µ –º–æ–∂–Ω–∞ –ø—Ä–∏–π–º–∞—Ç–∏ –æ–ø–ª–∞—Ç—É –≤—ñ–¥ —Ç—Ä–µ—Ç—ñ—Ö –æ—Å—ñ–±\n'–ñ–∏–≤–∞ —Å—Ö–µ–º–∞' ‚Äî –∫–æ–ª–∏ —Ç–µ–±–µ –≤—Ç–∏—Ä–∞—é—Ç—å—Å—è –≤ –¥–æ–≤—ñ—Ä—É\n–ö–ª–∞—Å–∏—á–Ω–∏–π '–Ω–∞—Ç—É–ø–Ω—è–∫': –Ω–∞—Ç–∏—Å–Ω—É–≤ ¬´–û–ø–ª–∞—á–µ–Ω–æ¬ª, –∞ –≥—Ä–æ—à–µ–π –Ω–µ–º–∞\n–ì–æ–ª–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–ø–µ–∫–∏, —â–æ–± –Ω–µ –≤—Ç—Ä–∞—Ç–∏—Ç–∏ USDT",xp:50},
7:{title:"–†–æ–±–æ—Ç–∞ –ø–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è—Ö: —Å—Ç–∞—Ä—Ç –º–µ–π–∫–µ—Ä–∞",short:"–ú–µ–π–∫–µ—Ä",text:"–Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è —Ç–∞ –ø—Ä–∏–π–º–∞—Ç–∏/–≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ –æ–ø–ª–∞—Ç—É\n–ì–æ—Ç–æ–≤—ñ —à–∞–±–ª–æ–Ω–∏ –æ–ø–∏—Å—ñ–≤ —ñ –∞–≤—Ç–æ-—Ä–µ–ø–ª–∞–π–µ—Ä\n–Ø–∫ –æ–±—Ö–æ–¥–∏—Ç–∏ T+1: –ø—Ä–æ–¥–∞–∂ ‚Äî –∫—É–ø—ñ–≤–ª—è = –ø–æ–≤–Ω–∏–π –∫—Ä—É–≥\n–°—Ç–∞—Ä—Ç—É—î–º–æ —Å—Ç–∞–±—ñ–ª—å–Ω–æ –Ω–∞–≤—ñ—Ç—å —ñ–∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏",xp:50},
8:{title:"–ê–ø–µ–ª—è—Ü—ñ—ó –±–µ–∑ –ø–∞–Ω—ñ–∫–∏",short:"–ê–ø–µ–ª—è—Ü—ñ—ó",text:"–ö–æ–ª–∏ —Ç–∏—Å–Ω—É—Ç–∏ ¬´–ü–æ–¥–∞—Ç–∏ –∞–ø–µ–ª—è—Ü—ñ—é¬ª —ñ —â–æ –ø–∏—Å–∞—Ç–∏\n–í–∏–ø–∞–¥–∫–∏: ¬´–æ–ø–ª–∞—á–µ–Ω–æ, –∞ –≥—Ä–æ—à–µ–π –Ω–µ–º–∞¬ª / ¬´–æ–ø–ª–∞—Ç–∏–≤, –∞ USDT –Ω–µ –≤—ñ–¥–ø—É—Å–∫–∞—é—Ç—å¬ª\n–Ø–∫—ñ –¥–æ–∫–∞–∑–∏ –ø—Ä–∏–∫—Ä—ñ–ø–∏—Ç–∏ (–∫–≤–∏—Ç–∞–Ω—Ü—ñ—ó, –≤—ñ–¥–µ–æ)\n–Ø–∫ –ø—Ä–∏—à–≤–∏–¥—à–∏—Ç–∏ —Ä–æ–∑–≥–ª—è–¥: –ø—Ä–æ—Å—Ç–∏–π —á–µ–∫–ª—ñ—Å—Ç",xp:50},
9:{title:"–ï–º—É–ª—è—Ç–æ—Ä: 1 –ü–ö –∑–∞–º—ñ—Å—Ç—å 100 —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤",short:"–ï–º—É–ª—è—Ç–æ—Ä",text:"–ù–∞–≤—ñ—â–æ –≤—ñ–Ω —É P2P —ñ —è–∫ –µ–∫–æ–Ω–æ–º–∏—Ç—å —á–∞—Å/–≥—Ä–æ—à—ñ\n–°–∫—ñ–ª—å–∫–∏ –≤—ñ–∫–æ–Ω —Ç—è–≥–Ω–µ —Å–ª–∞–±–∫–∏–π/—Å–µ—Ä–µ–¥–Ω—ñ–π/–ø–æ—Ç—É–∂–Ω–∏–π –ü–ö\n–ë–∞–Ω–∫–∏ –≤ –µ–º—É–ª—è—Ç–æ—Ä—ñ –ø—Ä–∞—Ü—é—é—Ç—å —Å—Ç–∞–±—ñ–ª—å–Ω–æ –ø—ñ—Å–ª—è –∞–ø–¥–µ–π—Ç—ñ–≤\n–û—Ç—Ä–∏–º–∞—î—à PDF –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º —ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏",xp:50},
10:{title:"–Ø–∫ —Ä–∞—Ö—É–≤–∞—Ç–∏ –ø—Ä–∏–±—É—Ç–æ–∫ —É P2P",short:"–ü—Ä–∏–±—É—Ç–æ–∫",text:"–†—É—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —ñ –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ % –∑–∞–∑–æ—Ä—É\nExcel/Google Sheets: –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è –¥–ª—è –æ–±–ª—ñ–∫—É\n–ù–∞—à Telegram-–±–æ—Ç: CSV –∑ Binance ‚Äî –ø–æ–≤–Ω–∏–π –∑–≤—ñ—Ç –∑–∞ –¥–µ–Ω—å/–º—ñ—Å—è—Ü—å",xp:50}
};
const QUIZZES={
1:[{q:"–©–æ —Ç–∞–∫–µ P2P-–∞—Ä–±—ñ—Ç—Ä–∞–∂?",o:["–¢–æ—Ä–≥—ñ–≤–ª—è —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω—É –±—ñ—Ä–∂—É","–ó–∞—Ä–æ–±—ñ—Ç–æ–∫ –Ω–∞ —Ä—ñ–∑–Ω–∏—Ü—ñ –∫—É—Ä—Å—ñ–≤ –º—ñ–∂ –ø–æ–∫—É–ø—Ü—è–º–∏ —Ç–∞ –ø—Ä–æ–¥–∞–≤—Ü—è–º–∏","–Ü–Ω–≤–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ –∞–∫—Ü—ñ—ó","–ú–∞–π–Ω—ñ–Ω–≥ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∏"],c:1,e:"P2P-–∞—Ä–±—ñ—Ç—Ä–∞–∂ ‚Äî –∑–∞—Ä–æ–±—ñ—Ç–æ–∫ –Ω–∞ —Å–ø—Ä–µ–¥—ñ –º—ñ–∂ —Ü—ñ–Ω–æ—é –∫—É–ø—ñ–≤–ª—ñ —Ç–∞ –ø—Ä–æ–¥–∞–∂—É –∫—Ä–∏–ø—Ç–∏ –º—ñ–∂ –ª—é–¥—å–º–∏."},
 {q:"–ü–æ—Ç–µ–Ω—Ü—ñ–∞–ª –¥–æ—Ö–æ–¥—É —É P2P?",o:["–î–æ $100/–º—ñ—Å","$500‚Äì$10K+/–º—ñ—Å","$50/–º—ñ—Å","–ù–µ–º–æ–∂–ª–∏–≤–æ"],c:1,e:"–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø—ñ–¥—Ö–æ–¥—ñ P2P –ø—Ä–∏–Ω–æ—Å–∏—Ç—å $500‚Äì$10,000+ –Ω–∞ –º—ñ—Å—è—Ü—å."}],
2:[{q:"–Ø–∫–∞ –±—ñ—Ä–∂–∞ #1 –¥–ª—è P2P?",o:["Bybit","OKX","Binance","Huobi"],c:2,e:"Binance ‚Äî –Ω–∞–π–±—ñ–ª—å—à–∞ –∫—Ä–∏–ø—Ç–æ–±—ñ—Ä–∂–∞ –∑ –Ω–∞–π–±—ñ–ª—å—à–∏–º –æ–±—Å—è–≥–æ–º P2P."},
 {q:"–î–ª—è —á–æ–≥–æ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è?",o:["–î–ª—è –∫—Ä–∞—Å–∏","–ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ª—ñ–º—ñ—Ç—ñ–≤ —Ç–∞ –¥–æ–≤—ñ—Ä–∏","–ù–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ","–¢—ñ–ª—å–∫–∏ –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è"],c:1,e:"–í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø—ñ–¥–≤–∏—â—É—î –ª—ñ–º—ñ—Ç–∏ —ñ –¥–æ–¥–∞—î –¥–æ–≤—ñ—Ä—É."}],
3:[{q:"–©–æ —Ç–∞–∫–µ 2FA?",o:["–î—Ä—É–≥–∏–π –∞–∫–∞—É–Ω—Ç","–î–≤–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è","–î–≤–∞ –∞–∫—Ç–∏–≤–∏","–ü–æ–¥–≤—ñ–π–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä"],c:1,e:"2FA –∑–∞—Ö–∏—â–∞—î –∞–∫–∞—É–Ω—Ç –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º –∫–æ–¥–æ–º –ø—Ä–∏ –≤—Ö–æ–¥—ñ."}],
4:[{q:"–©–æ —Ç–∞–∫–µ –ø—Ä–æ–≥—Ä—ñ–≤ –∞–∫–∞—É–Ω—Ç—É?",o:["–ú–∞–π–Ω—ñ–Ω–≥","–ù–∞—Ä–æ—â—É–≤–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –¥–ª—è —Å—Ç–∞—Ç—É—Å—É –º–µ—Ä—á–∞–Ω—Ç–∞","–í–∏–¥–∞–ª–µ–Ω–Ω—è —É–≥–æ–¥","–ó–º—ñ–Ω–∞ –ø–∞—Ä–æ–ª—è"],c:1,e:"–ü—Ä–æ–≥—Ä—ñ–≤ ‚Äî –ø–æ—Å—Ç—É–ø–æ–≤–µ –Ω–∞—Ä–æ—â—É–≤–∞–Ω–Ω—è —É–≥–æ–¥ –¥–ª—è —Å—Ç–∞—Ç—É—Å—É –º–µ—Ä—á–∞–Ω—Ç–∞."}],
5:[{q:"–ù–∞–≤—ñ—â–æ –æ–∫—Ä–µ–º–∞ –∫–∞—Ä—Ç–∫–∞ –¥–ª—è P2P?",o:["–î–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ","–£–Ω–∏–∫–Ω—É—Ç–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–æ—ó","–ù–µ–º–∞—î –ø—Ä–∏—á–∏–Ω–∏","–î–ª—è –∑–Ω–∏–∂–æ–∫"],c:1,e:"–û–∫—Ä–µ–º–∞ –∫–∞—Ä—Ç–∫–∞ —ñ–∑–æ–ª—é—î P2P-–æ–ø–µ—Ä–∞—Ü—ñ—ó –≤—ñ–¥ –ø–æ–≤—Å—è–∫–¥–µ–Ω–Ω–∏—Ö —Ñ—ñ–Ω–∞–Ω—Å—ñ–≤."}],
6:[{q:"–©–æ —Ç–∞–∫–µ —á–æ—Ä–Ω–∏–π —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫?",o:["–¢–∏–ø –∫—Ä–∏–ø—Ç–∏","–®–∞—Ö—Ä–∞–π—Å—å–∫–∞ —Å—Ö–µ–º–∞ –∑ —Ç—Ä–µ—Ç—ñ–º–∏ –æ—Å–æ–±–∞–º–∏","–ù–∞–∑–≤–∞ –±—ñ—Ä–∂—ñ","–í–∏–¥ –≥—Ä–∞—Ñ—ñ–∫–∞"],c:1,e:"–ß–æ—Ä–Ω–∏–π —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫ ‚Äî —Å—Ö–µ–º–∞ –∑ –≥—Ä–æ—à–∞–º–∏ –≤—ñ–¥ —Ç—Ä–µ—Ç—å–æ—ó –æ—Å–æ–±–∏."}],
7:[{q:"–©–æ —Ç–∞–∫–µ T+1?",o:["–ö–æ–º—ñ—Å—ñ—è","–ó–∞—Ç—Ä–∏–º–∫–∞ –≤–∏–≤–µ–¥–µ–Ω–Ω—è –Ω–∞ 1 –¥–µ–Ω—å","–¢–∏–ø –æ—Ä–¥–µ—Ä–∞","–¶—ñ–Ω–∞ –∞–∫—Ç–∏–≤—É"],c:1,e:"T+1 ‚Äî –ø—ñ—Å–ª—è –ø–æ–∫—É–ø–∫–∏ –∫—Ä–∏–ø—Ç–∏ —á–µ–∫–∞—Ç–∏ 1 –¥–µ–Ω—å –ø–µ—Ä–µ–¥ –≤–∏–≤–µ–¥–µ–Ω–Ω—è–º."}],
8:[{q:"–ö–æ–ª–∏ –ø–æ–¥–∞–≤–∞—Ç–∏ –∞–ø–µ–ª—è—Ü—ñ—é?",o:["–ó–∞–≤–∂–¥–∏","–ö–æ–ª–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç –ø–æ—Ä—É—à—É—î —É–º–æ–≤–∏","–î–ª—è –±–æ–Ω—É—Å—É","–ù—ñ–∫–æ–ª–∏"],c:1,e:"–ê–ø–µ–ª—è—Ü—ñ—è ‚Äî –∫–æ–ª–∏ –¥—Ä—É–≥–∏–π —É—á–∞—Å–Ω–∏–∫ –ø–æ—Ä—É—à—É—î —É–º–æ–≤–∏."}],
9:[{q:"–ù–∞–≤—ñ—â–æ –µ–º—É–ª—è—Ç–æ—Ä?",o:["–î–ª—è —ñ–≥–æ—Ä","–ö—ñ–ª—å–∫–∞ –±–∞–Ω–∫—ñ–≤ –∑ –æ–¥–Ω–æ–≥–æ –ü–ö","–î–ª—è —Ö–∞–∫—ñ–Ω–≥—É","–î–ª—è –≤—ñ–¥–µ–æ"],c:1,e:"–ï–º—É–ª—è—Ç–æ—Ä ‚Äî –∫—ñ–ª—å–∫–∞ –±–∞–Ω–∫—ñ–≤—Å—å–∫–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤ –Ω–∞ –æ–¥–Ω–æ–º—É –ü–ö."}],
10:[{q:"–Ø–∫ —Ä–∞—Ö—É–≤–∞—Ç–∏ –ø—Ä–∏–±—É—Ç–æ–∫?",o:["–ù–∞ –æ–∫–æ","Excel/Sheets –∑ –ø–æ–ª—è–º–∏","–ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ","–ó–∞ –∫—É—Ä—Å–æ–º –±—ñ—Ä–∂—ñ"],c:1,e:"–¢–∞–±–ª–∏—Ü—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –±–∞—á–∏—Ç–∏ —Ä–µ–∞–ª—å–Ω–∏–π –ø—Ä–∏–±—É—Ç–æ–∫ —ñ –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏."}]
};
const ACHIEVEMENTS={
first_step:{icon:"üèÖ",title:"–ü–µ—Ä—à–∏–π –∫—Ä–æ–∫",desc:"–ü–µ—Ä–µ–≥–ª—è–Ω—É–≤ –ø–µ—Ä—à–∏–π —É—Ä–æ–∫"},
halfway:{icon:"‚≠ê",title:"–ü–æ–ª–æ–≤–∏–Ω–∞ —à–ª—è—Ö—É",desc:"50% –∫—É—Ä—Å—É"},
graduate:{icon:"üèÜ",title:"–í–∏–ø—É—Å–∫–Ω–∏–∫",desc:"–í–µ—Å—å –∫—É—Ä—Å –ø—Ä–æ–π–¥–µ–Ω–∏–π"},
full_pack:{icon:"üíé",title:"–ü–æ–≤–Ω–∏–π –ø–∞–∫–µ—Ç",desc:"–û–±–∏–¥–≤–∞ –∫—É—Ä—Å–∏"},
quiz_ace:{icon:"üß†",title:"–†–æ–∑—É–º–Ω–∏–∫",desc:"5 –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –∫–≤—ñ–∑—ñ–≤"},
quiz_master:{icon:"üéì",title:"–ö–≤—ñ–∑-–º–∞–π—Å—Ç–µ—Ä",desc:"10 –∫–≤—ñ–∑—ñ–≤ –±–µ–∑ –ø–æ–º–∏–ª–æ–∫"},
streak_3:{icon:"üî•",title:"3 –¥–Ω—ñ –ø–æ—Å–ø—ñ–ª—å",desc:"–°–µ—Ä—ñ—è –∑ 3 –¥–Ω—ñ–≤"},
streak_7:{icon:"üî•",title:"–¢–∏–∂–Ω–µ–≤–∞ —Å–µ—Ä—ñ—è",desc:"7 –¥–Ω—ñ–≤"},
streak_30:{icon:"üëë",title:"–ú—ñ—Å—è—á–Ω–∞ —Å–µ—Ä—ñ—è",desc:"30 –¥–Ω—ñ–≤"},
level_5:{icon:"üìà",title:"–†—ñ–≤–µ–Ω—å 5",desc:"–î–æ—Å—è–≥–Ω—É–≤ 5-–≥–æ —Ä—ñ–≤–Ω—è"},
level_10:{icon:"üìà",title:"–†—ñ–≤–µ–Ω—å 10",desc:"–î–æ—Å—è–≥–Ω—É–≤ 10-–≥–æ —Ä—ñ–≤–Ω—è"},
level_20:{icon:"üìà",title:"–†—ñ–≤–µ–Ω—å 20",desc:"–î–æ—Å—è–≥–Ω—É–≤ 20-–≥–æ —Ä—ñ–≤–Ω—è"},
fast_learner:{icon:"‚ö°",title:"–®–≤–∏–¥–∫–∏–π —É—á–µ–Ω—å",desc:"3 —É—Ä–æ–∫–∏ –∑–∞ –¥–µ–Ω—å"},
night_owl:{icon:"ü¶â",title:"–ù—ñ—á–Ω–∞ —Å–æ–≤–∞",desc:"–£—Ä–æ–∫ –ø—ñ—Å–ª—è 23:00"},
early_bird:{icon:"üê¶",title:"–†–∞–Ω–Ω—è –ø—Ç–∞—à–∫–∞",desc:"–£—Ä–æ–∫ –¥–æ 7:00"},
curious:{icon:"üîç",title:"–î–æ–ø–∏—Ç–ª–∏–≤–∏–π",desc:"–ü—Ä–æ—á–∏—Ç–∞–≤ —É—Å—ñ FAQ"},
trader_10:{icon:"üí∞",title:"10 —É–≥–æ–¥",desc:"–ü—Ä–æ–≤—ñ–≤ 10 P2P-—É–≥–æ–¥"}
};
const FAQ=[
{q:"–ó —è–∫–æ—ó —Å—É–º–∏ –ø–æ—á–∏–Ω–∞—Ç–∏?",a:"–ú—ñ–Ω—ñ–º—É–º <b>$200‚Äì500</b>. –ó —Ü–∏–º –±—é–¥–∂–µ—Ç–æ–º:<br>‚Ä¢ 3‚Äì5 —É–≥–æ–¥/–¥–µ–Ω—å<br>‚Ä¢ $5‚Äì15 —â–æ–¥–µ–Ω–Ω–æ<br>‚Ä¢ –ù–∞–±–∏–≤–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É<br><br>–ù–∞–≤—ñ—Ç—å –∑ $50 –º–æ–∂–Ω–∞ –Ω–∞–≤—á–∏—Ç–∏—Å—è. <b>–ì–æ–ª–æ–≤–Ω–µ ‚Äî –ø–æ—á–∞—Ç–∏!</b>"},
{q:"–ß–∏ —î —Ä–∏–∑–∏–∫–∏?",a:"<b>–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏</b> ‚Äî –º—ñ–Ω—ñ–º—ñ–∑—É—î—Ç—å—Å—è –ø—Ä–æ–≥—Ä—ñ–≤–æ–º<br><b>–°–∫–∞–º</b> ‚Äî –∫—É—Ä—Å –Ω–∞–≤—á–∏—Ç—å —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞—Ç–∏<br><b>–í–æ–ª–∞—Ç–∏–ª—å–Ω—ñ—Å—Ç—å</b> ‚Äî –ø—Ä–∞—Ü—é—î–º–æ –∑ USDT<br><b>–§—ñ–Ω–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥</b> ‚Äî —É–Ω–∏–∫–∞—î—Ç—å—Å—è –ª—ñ–º—ñ—Ç–∞–º–∏"},
{q:"–°–∫—ñ–ª—å–∫–∏ —á–∞—Å—É?",a:"<b>1‚Äì2 –≥–æ–¥/–¥–µ–Ω—å</b> ‚Äî $200‚Äì500/–º—ñ—Å<br><b>3‚Äì4 –≥–æ–¥/–¥–µ–Ω—å</b> ‚Äî $500‚Äì2000/–º—ñ—Å<br><b>Full-time</b> ‚Äî $2000‚Äì10000+/–º—ñ—Å"},
{q:"–ß–∏ —Ü–µ –ª–µ–≥–∞–ª—å–Ω–æ?",a:"P2P ‚Äî <b>–ª–µ–≥–∞–ª—å–Ω–∞ –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å</b> —á–µ—Ä–µ–∑ –ª—ñ—Ü–µ–Ω–∑–æ–≤–∞–Ω—ñ –±—ñ—Ä–∂—ñ. –î–µ–∫–ª–∞—Ä—É–π –¥–æ—Ö–æ–¥–∏, –∑–±–µ—Ä—ñ–≥–∞–π —ñ—Å—Ç–æ—Ä—ñ—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π."}
];
const TIPS=["–ù—ñ–∫–æ–ª–∏ –Ω–µ –≤—ñ–¥–ø—É—Å–∫–∞–π –∫—Ä–∏–ø—Ç—É –ø–æ–∫–∏ –≥—Ä–æ—à—ñ –Ω–µ –Ω–∞ –∫–∞—Ä—Ç—ñ!","–¢—Ä–∏–º–∞–π –æ–∫—Ä–µ–º—É –∫–∞—Ä—Ç–∫—É –¥–ª—è P2P.","10 —É–≥–æ–¥ –ø–æ $100 –∫—Ä–∞—â–µ –∑–∞ 1 –Ω–∞ $1000.","–ó–∞–ø–∏—Å—É–π —É–≥–æ–¥–∏ ‚Äî –≤—ñ–¥—Å—Ç–µ–∂—É–π –ø—Ä–∏–±—É—Ç–æ–∫.","–°—Ç–µ–∂ –∑–∞ –∫—É—Ä—Å–∞–º–∏ –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –±—ñ—Ä–∂–∞—Ö.","2FA —Å–∫—Ä—ñ–∑—å. –ë–µ–∑–ø–µ–∫–∞ = –≥—Ä–æ—à—ñ.","–ü—Ä–∞—Ü—é–π –∑ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏–º–∏ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏.","–°—Ç–∞–±—ñ–ª—å–Ω—ñ 1‚Äì2% –∫—Ä–∞—â–µ —Ä–∏–∑–∏–∫–æ–≤–∏—Ö 5%.","–ù–∞–π–∫—Ä–∞—â–∏–π —á–∞—Å ‚Äî —Ä–∞–Ω–æ–∫ —ñ –≤–µ—á—ñ—Ä.","–í–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –∞–∫–∞—É–Ω—Ç–∏ = –±—ñ–ª—å—à–µ –¥–æ–≤—ñ—Ä–∏."];
const FACTS=["–û–±—Å—è–≥ P2P –Ω–∞ Binance > $500M/–¥–µ–Ω—å!","–°–µ—Ä–µ–¥–Ω—ñ–π —Ç—Ä–µ–π–¥–µ—Ä: 1‚Äì3% –Ω–∞ —É–≥–æ–¥—ñ.","78% —É—Å–ø—ñ—à–Ω–∏—Ö –≤–µ–¥—É—Ç—å –æ–±–ª—ñ–∫.","–ù–∞–π–±—ñ–ª—å—à–∏–π —Ä–∏–Ω–æ–∫ ‚Äî –ù—ñ–≥–µ—Ä—ñ—è.","–ú–µ—Ä—á–∞–Ω—Ç–∏ 99%+ –æ—Ç—Ä–∏–º—É—é—Ç—å 3x —É–≥–æ–¥.","USDT ‚Äî 89% –≤—Å—ñ—Ö P2P-—É–≥–æ–¥.","–î–æ—Å–≤—ñ–¥—á–µ–Ω–∏–π: 20‚Äì50 —É–≥–æ–¥/–¥–µ–Ω—å.","–ü—Ä–æ–≥—Ä—ñ–≤ –∫–∞—Ä—Ç–∫–∏: 2‚Äì4 —Ç–∏–∂–Ω—ñ."];
const CHALLENGES=[{id:"lesson",text:"–ü–µ—Ä–µ–≥–ª—è–Ω—å 1 —É—Ä–æ–∫",xp:20,type:"lesson",n:1},{id:"2lessons",text:"–ü–µ—Ä–µ–≥–ª—è–Ω—å 2 —É—Ä–æ–∫–∏",xp:40,type:"lesson",n:2},
{id:"quiz",text:"–ü—Ä–æ–π–¥–∏ 1 –∫–≤—ñ–∑",xp:25,type:"quiz",n:1},{id:"2quiz",text:"–ü—Ä–æ–π–¥–∏ 2 –∫–≤—ñ–∑–∏",xp:50,type:"quiz",n:2},
{id:"tip",text:"–ü—Ä–æ—á–∏—Ç–∞–π –ø–æ—Ä–∞–¥—É",xp:10,type:"tip",n:1},{id:"profile",text:"–ü–µ—Ä–µ–≥–ª—è–Ω—å –ø—Ä–æ—Ñ—ñ–ª—å",xp:10,type:"profile",n:1}];
const RANKS=[[1,"üå± –ù–æ–≤–∞—á–æ–∫"],[3,"üìñ –£—á–µ–Ω—å"],[5,"üéì –°—Ç—É–¥–µ–Ω—Ç"],[8,"üî• –î–æ—Å–≤—ñ–¥—á–µ–Ω–∏–π"],[12,"üöÄ –ü—Ä–æ—Å—É–Ω—É—Ç–∏–π"],
[16,"‚ö° –ú–∞–π—Å—Ç–µ—Ä"],[20,"üèÜ –ï–∫—Å–ø–µ—Ä—Ç"],[25,"üëë –õ–µ–≥–µ–Ω–¥–∞"]];
const MAT1="–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –ö—É—Ä—Å 1:\n\n1. –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ (30 —Ö–≤ ‚Äì 6 –≥–æ–¥, 7 –¥–Ω—ñ–≤)\n2. –ú–µ—Ç–æ–¥–∏—á–∫–∞: –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π\n3. –ú–µ—Ç–æ–¥–∏—á–∫–∞: –Ø–∫ –ø–æ–¥–∞—Ç–∏ –∞–ø–µ–ª—è—Ü—ñ—é";
const MAT2="–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –ö—É—Ä—Å 2:\n\n1. –ß–∞—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ (5‚Äì30 —Ö–≤, 14 –¥–Ω—ñ–≤)\n2. Pro-–±–æ—Ç –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ (14 –¥–Ω—ñ–≤)\n3. –°–æ–∑–≤–æ–Ω –≤ –Ω–µ–¥—ñ–ª—é\n4. –ú–µ—Ç–æ–¥–∏—á–∫–∞ –ø–æ –±–∞–Ω–∫–∞–º\n5. –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—ñ–≤\n6. –ï–º—É–ª—è—Ç–æ—Ä\n7. –ü–æ—à—É–∫ –∫–ª—ñ—î–Ω—Ç—ñ–≤";
const TOTAL=10;const ADMINS=[728309625,584189889];

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const API=(function(){var h=location.hostname;
  if(h.indexOf('ngrok')>=0)return location.origin;
  if(h==='daviscortes.github.io')return'https://fd19-2a02-ab04-2ec6-3f00-dda9-5656-8b3f-3407.ngrok-free.app';
  if(h==='localhost'||h==='127.0.0.1')return'http://'+h+':8000';
  return location.origin})();

function api(ep,method,body){
  method=method||'GET';var o={method:method,headers:{'Content-Type':'application/json','ngrok-skip-browser-warning':'true'}};
  if(body)o.body=JSON.stringify(body);
  return fetch(API+ep,o).then(function(r){if(!r.ok)return r.json().catch(function(){return{detail:r.statusText}}).then(function(e){throw new Error(e.detail||r.statusText)});return r.json()}).catch(function(e){console.warn('API:',ep,e.message);return null})}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function xpFor(l){return Math.floor(100*Math.pow(l,1.5))}
function lvlOf(xp){var l=1;while(xpFor(l+1)<=xp)l++;return l}
function xpProg(xp){var l=lvlOf(xp);return{cur:xp-xpFor(l),need:xpFor(l+1)-xpFor(l)}}
function rankOf(l){var r=RANKS[0][1];for(var i=0;i<RANKS.length;i++){if(l>=RANKS[i][0])r=RANKS[i][1]}return r}
function avatarUrl(n,s){return'https://ui-avatars.com/api/?name='+encodeURIComponent(n||'?')+'&size='+(s||128)+'&background=6C5CE7&color=fff&bold=true&format=svg'}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   APP ‚Äî CORE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var App={
  tg:null,user:null,userId:null,online:false,chart:null,profitChart:null,
  state:{c1:[],c2:[],xp:0,streak:0,qOk:0,qTot:0,achs:[],plan:'none',refCount:0,level:1,rank:'üå± –ù–æ–≤–∞—á–æ–∫',pos:0},

  /* ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ */
  init:function(){
    var self=this;
    self.tg=window.Telegram&&Telegram.WebApp?Telegram.WebApp:null;
    if(self.tg){self.tg.ready();self.tg.expand();self.tg.BackButton.onClick(function(){self.back()})}
    self.user=self.tg&&self.tg.initDataUnsafe?self.tg.initDataUnsafe.user:null;
    self.userId=self.user?self.user.id:0;
    self.initBg();
    var loaded=false;
    function hideLoading(){if(loaded)return;loaded=true;document.getElementById('loadingScreen').classList.add('hide');setTimeout(function(){document.getElementById('loadingScreen').style.display='none'},600)}
    setTimeout(function(){if(!loaded){console.warn('Loading timeout, forcing hide');self.renderHome();hideLoading()}},5000);
    self.sync().then(function(){
      Object.keys(self.modules).forEach(function(k){if(self.modules[k].init)self.modules[k].init()});
      self.renderHome();
      hideLoading();
    }).catch(function(e){console.error('Init error:',e);self.renderHome();hideLoading()});
  },

  sync:function(){
    var self=this;
    if(!self.userId)return Promise.resolve();
    return api('/api/user/'+self.userId).then(function(d){
      if(d){self.online=true;
        self.state.xp=d.xp||0;self.state.streak=d.streak_days||0;
        self.state.c1=d.c1_viewed||[];self.state.c2=d.c2_viewed||[];
        self.state.achs=d.achievements||[];self.state.level=d.level||1;
        self.state.rank=d.rank||'üå± –ù–æ–≤–∞—á–æ–∫';self.state.pos=d.position||0;
        self.state.plan=d.plan||'none';self.state.refCount=d.referral_count||0;
        if(d.quiz_stats){self.state.qOk=d.quiz_stats.correct||0;self.state.qTot=d.quiz_stats.total||0}}
    });
  },

  /* ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ */
  go:function(p){
    document.querySelectorAll('.page').forEach(function(el){el.classList.remove('active')});
    var pg=document.getElementById('p-'+p);if(pg)pg.classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(function(n){n.classList.toggle('active',n.dataset.p===p)});
    if(this.tg){if(p==='home')this.tg.BackButton.hide();else this.tg.BackButton.show()}
    var m=this.modules;
    switch(p){case'home':this.renderHome();break;case'profile':m.profile.render();break;
      case'leaderboard':m.leaderboard.render();break;case'achievements':m.achievements.renderAll();break;
      case'ai':m.ai.onOpen();break;case'accountant':m.accountant.render();break;
      case'settings':m.settings.render();break;case'admin':m.admin.render();break}
    window.scrollTo({top:0,behavior:'smooth'});
  },

  back:function(){
    var el=document.querySelector('.page.active');if(!el)return this.go('home');
    var id=el.id.replace('p-','');
    var r={course:'home',lesson:'course',quiz:'lesson',quizResults:'lesson',achievements:'profile',settings:'profile'};
    this.go(r[id]||'home');
  },

  /* ‚îÄ‚îÄ‚îÄ HOME ‚îÄ‚îÄ‚îÄ */
  renderHome:function(){
    var s=this.state,name=this.user?this.user.first_name:'–ì—Ä–∞–≤–µ—Ü—å';
    var l=lvlOf(s.xp),p=xpProg(s.xp),pct=p.need>0?Math.min(100,Math.round(p.cur/p.need*100)):0;
    var u=document.getElementById('homeUser');
    u.querySelector('.avatar').src=avatarUrl(name);u.querySelector('.name').textContent=name;
    u.querySelector('.rank').textContent=rankOf(l)+' ‚Ä¢ Lv.'+l;
    u.querySelector('.xp-info').textContent=s.xp+' XP ‚Ä¢ '+p.cur+'/'+p.need;
    u.querySelector('.fill').style.width=pct+'%';
    var c1p=Math.round(s.c1.length/TOTAL*100),c2p=Math.round(s.c2.length/TOTAL*100);
    document.getElementById('homeCourses').innerHTML=
      '<div class="g-card course-card" onclick="App.modules.courses.open(\'c1\')"><div class="tag tag-basic">BASIC</div><div class="emoji">üìò</div><div class="title">–ë–ê–ó–û–í–ò–ô –ö–£–†–°</div><div class="sub">'+s.c1.length+'/'+TOTAL+' —É—Ä–æ–∫—ñ–≤</div><div class="prog"><div class="prog-text"><span>–ü—Ä–æ–≥—Ä–µ—Å</span><span>'+c1p+'%</span></div><div class="xp-bar"><div class="fill" style="width:'+c1p+'%"></div></div></div></div>'+
      '<div class="g-card course-card" onclick="App.modules.courses.open(\'c2\')"><div class="tag tag-pro">PRO</div><div class="emoji">üìó</div><div class="title">PRO –ö–£–†–°</div><div class="sub">'+s.c2.length+'/'+TOTAL+' —É—Ä–æ–∫—ñ–≤</div><div class="prog"><div class="prog-text"><span>–ü—Ä–æ–≥—Ä–µ—Å</span><span>'+c2p+'%</span></div><div class="xp-bar"><div class="fill" style="width:'+c2p+'%"></div></div></div></div>';
    // challenge
    var d=Math.floor(Date.now()/(864e5)),ch=CHALLENGES[d%CHALLENGES.length],done=parseInt(sessionStorage.getItem('ch_'+ch.id)||'0');
    var cp=Math.min(100,Math.round(done/ch.n*100));
    document.getElementById('homeChallenge').innerHTML=
      '<div class="page-header" style="margin-bottom:8px"><div class="icon-box" style="color:var(--gold)">üéØ</div><div><h2 style="font-size:12px">DAILY MISSION</h2><div class="sub">+'+ch.xp+' XP</div></div></div>'+
      '<div style="font-size:14px;margin-bottom:8px">'+ch.text+'</div>'+
      '<div style="display:flex;align-items:center;gap:10px"><div class="xp-bar" style="flex:1"><div class="fill" style="width:'+cp+'%"></div></div><span style="font-size:12px;color:var(--text2);white-space:nowrap">'+done+'/'+ch.n+'</span></div>';
    // tip
    document.getElementById('tipText').innerHTML='üí° '+TIPS[d%TIPS.length];
    document.getElementById('factText').innerHTML='üìä '+FACTS[d%FACTS.length];
    // admin btn
    if(this.userId && ADMINS.indexOf(this.userId)>=0){
      var existing=document.getElementById('adminNavBtn');
      if(!existing){var nav=document.querySelector('.nav');
        var ab=document.createElement('div');ab.className='nav-btn';ab.id='adminNavBtn';ab.dataset.p='admin';
        ab.onclick=function(){App.go('admin')};ab.innerHTML='<i class="fas fa-shield-alt"></i><span>Admin</span>';nav.appendChild(ab)}
    }
  },

  /* ‚îÄ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ */
  toast:function(t,type,ms){type=type||'success';ms=ms||3000;
    var el=document.createElement('div');el.className='toast '+type;el.textContent=t;
    document.body.appendChild(el);setTimeout(function(){el.remove()},ms)},

  xpPopup:function(amount){
    var el=document.createElement('div');el.className='xp-popup';el.textContent='+'+amount+' XP';
    document.body.appendChild(el);setTimeout(function(){el.remove()},900);
    if(typeof confetti==='function')confetti({particleCount:35,spread:60,origin:{y:0.6},colors:['#00f0ff','#a855f7','#f472b6']})},

  openModal:function(html){document.getElementById('modalBody').innerHTML=html;document.getElementById('modal').classList.add('show')},
  closeModal:function(){document.getElementById('modal').classList.remove('show')},

  incChallenge:function(type){
    var d=Math.floor(Date.now()/(864e5)),ch=CHALLENGES[d%CHALLENGES.length];
    if(ch.type!==type)return;var k='ch_'+ch.id,cur=parseInt(sessionStorage.getItem(k)||'0');
    if(cur>=ch.n)return;cur++;sessionStorage.setItem(k,cur);
    if(cur>=ch.n){this.state.xp+=ch.xp;this.toast('+'+ch.xp+' XP –∑–∞ –º—ñ—Å—ñ—é!','info')}},

  /* ‚îÄ‚îÄ‚îÄ BG PARTICLES ‚îÄ‚îÄ‚îÄ */
  initBg:function(){
    var c=document.getElementById('bgCanvas'),ctx=c.getContext('2d');
    function resize(){c.width=window.innerWidth;c.height=window.innerHeight}resize();
    window.addEventListener('resize',resize);
    var pts=[];for(var i=0;i<60;i++)pts.push({x:Math.random()*c.width,y:Math.random()*c.height,
      vx:(Math.random()-.5)*.3,vy:(Math.random()-.5)*.3,r:Math.random()*1.5+.5,o:Math.random()*.4+.1});
    function draw(){ctx.clearRect(0,0,c.width,c.height);
      pts.forEach(function(p){p.x+=p.vx;p.y+=p.vy;
        if(p.x<0)p.x=c.width;if(p.x>c.width)p.x=0;if(p.y<0)p.y=c.height;if(p.y>c.height)p.y=0;
        ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle='rgba(0,240,255,'+p.o+')';ctx.fill()});
      // connect lines
      for(var i=0;i<pts.length;i++){for(var j=i+1;j<pts.length;j++){
        var dx=pts[i].x-pts[j].x,dy=pts[i].y-pts[j].y,dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<100){ctx.beginPath();ctx.moveTo(pts[i].x,pts[i].y);ctx.lineTo(pts[j].x,pts[j].y);
          ctx.strokeStyle='rgba(0,240,255,'+(0.06*(1-dist/100))+')';ctx.lineWidth=.5;ctx.stroke()}}}
      requestAnimationFrame(draw)}draw();
  },

  /* ‚îÄ‚îÄ‚îÄ MODULES ‚îÄ‚îÄ‚îÄ */
  modules:{}
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE: COURSES
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
App.modules.courses=(function(){
  var cur=null,curLesson=null;
  return{
    init:function(){},
    open:function(ck){
      cur=ck;var pref=ck==='c1'?'c1':'c2',viewed=App.state[pref]||[];
      document.getElementById('courseTitle').textContent=ck==='c1'?'–ë–ê–ó–û–í–ò–ô –ö–£–†–°':'PRO –ö–£–†–°';
      document.getElementById('courseSub').textContent=viewed.length+'/'+TOTAL+' –ø—Ä–æ–π–¥–µ–Ω–æ';
      document.getElementById('courseFill').style.width=Math.round(viewed.length/TOTAL*100)+'%';
      var h='';for(var i=1;i<=TOTAL;i++){var l=LESSONS[i],lid=pref+'_l'+i,v=viewed.indexOf(lid)>=0;
        h+='<div class="lesson-tile'+(v?' done':'')+'" onclick="App.modules.courses.lesson('+i+')"><div class="n">'+i+'</div><div class="t">'+l.short+'</div></div>'}
      document.getElementById('lessonGrid').innerHTML=h;App.go('course');
    },
    lesson:function(n){
      curLesson=n;var l=LESSONS[n];if(!l)return;
      document.getElementById('lessonTitle').textContent='–£—Ä–æ–∫ '+n+'. '+l.title;
      document.getElementById('lessonVideo').innerHTML='<div class="video-wrap"><i class="fas fa-play-circle"></i></div>';
      document.getElementById('lessonBody').textContent=l.text;
      var hq=QUIZZES[n]&&QUIZZES[n].length>0;
      document.getElementById('lessonQuizBtn').innerHTML=hq?'<button class="btn btn-neon btn-block" onclick="App.modules.quizzes.start('+n+')"><i class="fas fa-brain"></i> –ü–†–û–ô–¢–ò –ö–í–Ü–ó</button>':'';
      document.getElementById('lessonNav').innerHTML=
        (n>1?'<button class="btn btn-ghost btn-sm" onclick="App.modules.courses.lesson('+(n-1)+')"><i class="fas fa-arrow-left"></i> –£—Ä–æ–∫ '+(n-1)+'</button>':'<span></span>')+
        (n<TOTAL?'<button class="btn btn-ghost btn-sm" onclick="App.modules.courses.lesson('+(n+1)+')">–£—Ä–æ–∫ '+(n+1)+' <i class="fas fa-arrow-right"></i></button>':'<span></span>');
      App.go('lesson');this.markViewed(n);
    },
    markViewed:function(n){
      if(!cur)return;var pref=cur==='c1'?'c1':'c2',lid=pref+'_l'+n,key=pref;
      if(App.state[key].indexOf(lid)>=0)return;
      App.state[key].push(lid);App.state.xp+=50;App.xpPopup(50);
      if(App.online)api('/api/lesson/view','POST',{user_id:App.userId,lesson_id:lid,course:cur==='c1'?'course1':'course2'});
      App.incChallenge('lesson');
    },
    backToCourse:function(){if(cur)this.open(cur);else App.go('home')},
    materials:function(){var t=cur==='c1'?MAT1:MAT2;if(App.tg)App.tg.showAlert(t);else alert(t)},
    getCur:function(){return cur},getCurLesson:function(){return curLesson}
  };
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE: QUIZZES
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
App.modules.quizzes=(function(){
  var qs=null;
  return{
    init:function(){},
    start:function(ln){var q=QUIZZES[ln];if(!q||!q.length)return;
      qs={lesson:ln,questions:q,cur:0,ok:0,ans:[]};this.render();App.go('quiz')},
    render:function(){var q=qs.questions[qs.cur],dots='';
      for(var i=0;i<qs.questions.length;i++){var c='q-dot';if(i===qs.cur)c+=' now';
        else if(typeof qs.ans[i]!=='undefined')c+=qs.ans[i]?' ok':' bad';dots+='<div class="'+c+'"></div>'}
      document.getElementById('quizDots').innerHTML=dots;
      document.getElementById('quizQ').textContent=q.q;
      var h='';for(var j=0;j<q.o.length;j++)h+='<div class="quiz-opt" onclick="App.modules.quizzes.answer('+j+')">'+q.o[j]+'</div>';
      document.getElementById('quizOpts').innerHTML=h;document.getElementById('quizExplain').style.display='none'},
    answer:function(si){if(typeof qs.ans[qs.cur]!=='undefined')return;
      var q=qs.questions[qs.cur],ok=si===q.c;qs.ans[qs.cur]=ok;if(ok)qs.ok++;
      var opts=document.querySelectorAll('#quizOpts .quiz-opt');
      opts[si].classList.add(ok?'correct':'wrong');if(!ok)opts[q.c].classList.add('correct');
      var ex=document.getElementById('quizExplain');ex.textContent=q.e;ex.style.display='block';
      App.state.qTot++;if(ok){App.state.qOk++;App.state.xp+=30;App.xpPopup(30)}
      if(App.online)api('/api/quiz/answer','POST',{user_id:App.userId,course:App.modules.courses.getCur()==='c1'?'course1':'course2',lesson:qs.lesson,q_index:qs.cur,correct:ok});
      App.incChallenge('quiz');
      var self=this;setTimeout(function(){if(qs.cur<qs.questions.length-1){qs.cur++;self.render()}else self.results()},1500)},
    results:function(){var pct=Math.round(qs.ok/qs.questions.length*100);
      var e='üòî',m='–°–ø—Ä–æ–±—É–π —â–µ!';if(pct>=80){e='üéâ';m='–ß–£–î–û–í–û!'}else if(pct>=50){e='üëç';m='–ù–µ–ø–æ–≥–∞–Ω–æ!'}
      var bonus='';if(pct===100){App.state.xp+=100;bonus='<div style="margin-top:12px;color:var(--green);font-family:var(--font-display);font-weight:700">+100 XP PERFECT!</div>';
        if(typeof confetti==='function')confetti({particleCount:100,spread:100,origin:{y:0.5}})}
      document.getElementById('quizResContent').innerHTML=
        '<div style="font-size:60px;margin-bottom:14px">'+e+'</div>'+
        '<h2 style="font-family:var(--font-display);font-size:22px;font-weight:800;margin-bottom:8px">'+m+'</h2>'+
        '<p style="color:var(--text2)">'+qs.ok+'/'+qs.questions.length+' ('+pct+'%)</p>'+bonus+
        '<div style="margin-top:24px;display:flex;gap:10px;justify-content:center">'+
        '<button class="btn btn-ghost" onclick="App.modules.quizzes.start('+qs.lesson+')"><i class="fas fa-redo"></i> –©–µ —Ä–∞–∑</button>'+
        '<button class="btn btn-neon" onclick="App.modules.courses.backToCourse()"><i class="fas fa-arrow-left"></i> –ö—É—Ä—Å</button></div>';
      App.go('quizResults')},
    backToLesson:function(){var ln=qs?qs.lesson:null;if(ln)App.modules.courses.lesson(ln);else App.go('home')}
  };
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE: AI ASSISTANT
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
App.modules.ai=(function(){
  var loaded=false;
  return{
    init:function(){},
    onOpen:function(){
      if(App.online&&!loaded){loaded=true;
        api('/api/ai/history?user_id='+App.userId+'&limit=20').then(function(h){
          if(h&&h.length){var mc=document.getElementById('aiMsgs');h.reverse();
            for(var i=0;i<h.length;i++){addMsg('user',h[i].question);addMsg('bot',h[i].answer,h[i].id)}
            mc.scrollTop=mc.scrollHeight}})}},
    quick:function(el){document.getElementById('aiInput').value=el.textContent;this.send()},
    send:function(){var inp=document.getElementById('aiInput'),q=inp.value.trim();if(!q)return;inp.value='';
      document.getElementById('aiQuickQs').style.display='none';addMsg('user',q);
      var typ=document.getElementById('aiTyping');typ.style.display='block';
      var mc=document.getElementById('aiMsgs');mc.scrollTop=mc.scrollHeight;
      document.getElementById('aiSendBtn').disabled=true;
      if(App.online){api('/api/ai/ask','POST',{user_id:App.userId,question:q}).then(function(r){
        typ.style.display='none';document.getElementById('aiSendBtn').disabled=false;
        if(r&&r.answer)addMsg('bot',r.answer,r.conv_id,r.sources);
        else addMsg('bot','–ü–æ–º–∏–ª–∫–∞. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.');mc.scrollTop=mc.scrollHeight})}
      else{typ.style.display='none';document.getElementById('aiSendBtn').disabled=false;
        addMsg('bot','API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä.');mc.scrollTop=mc.scrollHeight}},
    rate:function(id,r,btn){if(btn.classList.contains('rated'))return;
      api('/api/ai/rate','POST',{conv_id:id,rating:r});btn.classList.add('rated');App.toast(r>0?'–î—è–∫—É—é!':'–í—Ä–∞—Ö–æ–≤–∞–Ω–æ','info')},
    detail:function(id){var typ=document.getElementById('aiTyping');typ.style.display='block';
      api('/api/ai/detail','POST',{conv_id:id}).then(function(r){typ.style.display='none';
        if(r&&r.answer)addMsg('bot',r.answer);var mc=document.getElementById('aiMsgs');mc.scrollTop=mc.scrollHeight})},
    example:function(id){var typ=document.getElementById('aiTyping');typ.style.display='block';
      api('/api/ai/example','POST',{conv_id:id}).then(function(r){typ.style.display='none';
        if(r&&r.answer)addMsg('bot',r.answer);var mc=document.getElementById('aiMsgs');mc.scrollTop=mc.scrollHeight})}
  };
  function md(t){
    t=t.replace(/```([\s\S]*?)```/g,function(m,c){return'<pre><code>'+c.replace(/</g,'&lt;')+'</code></pre>'});
    t=t.replace(/`([^`]+)`/g,'<code>$1</code>');
    t=t.replace(/^### (.+)$/gm,'<h3>$1</h3>');
    t=t.replace(/^## (.+)$/gm,'<h2>$1</h2>');
    t=t.replace(/^# (.+)$/gm,'<h2>$1</h2>');
    t=t.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
    t=t.replace(/\*(.+?)\*/g,'<em>$1</em>');
    t=t.replace(/^---$/gm,'<hr>');
    t=t.replace(/^> (.+)$/gm,'<blockquote>$1</blockquote>');
    t=t.replace(/^\d+\. (.+)$/gm,'<li>$1</li>');
    t=t.replace(/^- (.+)$/gm,'<li>$1</li>');
    t=t.replace(/(<li>.*<\/li>)/gs,function(m){return'<ul>'+m+'</ul>'});
    t=t.replace(/<\/ul>\s*<ul>/g,'');
    t=t.replace(/\n{2,}/g,'</p><p>');
    t=t.replace(/\n/g,'<br>');
    t='<p>'+t+'</p>';
    t=t.replace(/<p><(h[23]|pre|ul|ol|hr|blockquote)/g,'<$1');
    t=t.replace(/<\/(h[23]|pre|ul|ol|hr|blockquote)><\/p>/g,'</$1>');
    t=t.replace(/<p><\/p>/g,'');
    return t}
  function addMsg(role,text,cid,src){var mc=document.getElementById('aiMsgs'),d=document.createElement('div');
    d.className='ai-bubble '+role;
    if(role==='bot'){var h=md(text);if(src)h+='<div class="src">üìö '+src+'</div>';
      if(cid)h+='<div class="actions">'+
        '<div class="a-btn" onclick="App.modules.ai.rate('+cid+',1,this)">üëç</div>'+
        '<div class="a-btn" onclick="App.modules.ai.rate('+cid+',-1,this)">üëé</div>'+
        '<div class="a-btn" onclick="App.modules.ai.detail('+cid+')">–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</div>'+
        '<div class="a-btn" onclick="App.modules.ai.example('+cid+')">–ü—Ä–∏–∫–ª–∞–¥</div></div>';
      d.innerHTML=h}else d.textContent=text;mc.appendChild(d)}
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE: ACCOUNTANT
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
App.modules.accountant=(function(){
  var chart=null,binStatus=null,_dashCache=null;
  function uid(){return App.userId||0}
  /* ‚îÄ‚îÄ Merchant badge SVG (animated verified shield) ‚îÄ‚îÄ */
  function merchantSvg(size){
    size=size||16;
    return '<svg width="'+size+'" height="'+size+'" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'+
      '<defs><linearGradient id="mg" x1="0" y1="0" x2="24" y2="24" gradientUnits="userSpaceOnUse">'+
      '<stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/></linearGradient>'+
      '<filter id="mgl"><feDropShadow dx="0" dy="0" stdDeviation="1.5" flood-color="#fbbf24" flood-opacity="0.6"/></filter></defs>'+
      '<path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z" fill="url(#mg)" filter="url(#mgl)" opacity="0.9"/>'+
      '<path d="M10 15.5l-3.5-3.5 1.41-1.41L10 12.67l5.59-5.59L17 8.5l-7 7z" fill="#1a1a2e" stroke="#1a1a2e" stroke-width="0.5"/></svg>'
  }
  function merchantBadge(){return '<span class="merchant-badge">'+merchantSvg(14)+' MERCHANT</span>'}
  function merchantBadgeSm(){return '<span class="merchant-badge-sm" title="–í–µ—Ä–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –º–µ—Ä—á–∞–Ω—Ç">'+merchantSvg(12)+'</span>'}
  return{
    init:function(){},
    render:function(){
      var self=this,el=document.getElementById('accountantContent');
      if(!el)return;
      el.innerHTML='<div class="g-card" style="text-align:center"><div class="spinner"></div><p style="color:var(--text2);margin-top:10px">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p></div>';
      if(!App.online){self.renderDisconnected(null);return}
      api('/api/binance/keys/'+uid()).then(function(kr){
        if(!kr||!kr.has_keys){self.renderSetup();return}
        api('/api/binance/status?user_id='+uid()).then(function(st){
          binStatus=st;
          if(st&&st.connected){
            Promise.all([
              api('/api/binance/dashboard?user_id='+uid()),
              api('/api/binance/avg-price'),
              api('/api/binance/today?user_id='+uid())
            ]).then(function(results){
              _dashCache=results[0];
              self.renderDashboard(results[0],results[1],st,results[2])
            }).catch(function(){self.renderDisconnected(st)});
          }else{self.renderDisconnected(st)}
        });
      });
    },
    renderSetup:function(){
      var el=document.getElementById('accountantContent');
      el.innerHTML=
        '<div class="g-card" style="text-align:center;padding:30px">'+
        '<div style="font-size:50px;margin-bottom:14px">üîë</div>'+
        '<h3 style="font-family:var(--font-display);font-size:16px;margin-bottom:10px">–ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø BINANCE</h3>'+
        '<p style="font-size:13px;color:var(--text2);margin-bottom:20px">–î–æ–¥–∞–π—Ç–µ –≤–∞—à—ñ API –∫–ª—é—á—ñ Binance —â–æ–± –±–∞—á–∏—Ç–∏ —Å–≤–æ—ó —É–≥–æ–¥–∏ —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫—É</p>'+
        '<div style="text-align:left;margin-bottom:12px">'+
        '<label style="font-size:11px;color:var(--text3);display:block;margin-bottom:4px">API Key</label>'+
        '<input id="binApiKey" type="text" placeholder="–í–∞—à Binance API Key" style="width:100%;padding:10px 12px;background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--r-xs);color:var(--text);font-size:13px;outline:none"></div>'+
        '<div style="text-align:left;margin-bottom:16px">'+
        '<label style="font-size:11px;color:var(--text3);display:block;margin-bottom:4px">Secret Key</label>'+
        '<input id="binSecretKey" type="password" placeholder="–í–∞—à Binance Secret Key" style="width:100%;padding:10px 12px;background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--r-xs);color:var(--text);font-size:13px;outline:none"></div>'+
        '<div id="binKeyError" style="color:var(--red);font-size:12px;margin-bottom:10px;display:none"></div>'+
        '<button class="btn btn-neon btn-block" onclick="App.modules.accountant.saveKeys()"><i class="fas fa-save"></i> –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–ª—é—á—ñ</button>'+
        '<div style="margin-top:14px;padding:12px;background:var(--glass);border-radius:var(--r-xs);font-size:11px;color:var(--text3);text-align:left">'+
        '<div style="font-weight:600;margin-bottom:6px;color:var(--gold)">‚ö†Ô∏è –Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–ª—é—á—ñ:</div>'+
        '<div>1. Binance ‚Üí API Management</div>'+
        '<div>2. Create API ‚Üí –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É</div>'+
        '<div>3. –£–≤—ñ–º–∫–Ω—ñ—Ç—å: <b>Enable Reading</b></div>'+
        '<div>4. –°–∫–æ–ø—ñ—é–π—Ç–µ API Key —Ç–∞ Secret Key</div>'+
        '<div style="margin-top:6px;color:var(--red)">–ù–ï –≤–º–∏–∫–∞–π—Ç–µ –≤–∏–≤–µ–¥–µ–Ω–Ω—è —Ç–∞ —Ç–æ—Ä–≥—ñ–≤–ª—é!</div></div></div>';
    },
    saveKeys:function(){
      var ak=document.getElementById('binApiKey').value.trim();
      var sk=document.getElementById('binSecretKey').value.trim();
      var errEl=document.getElementById('binKeyError');
      if(!ak||!sk){errEl.textContent='–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–∏–¥–≤–∞ –ø–æ–ª—è';errEl.style.display='block';return}
      errEl.style.display='none';
      var el=document.getElementById('accountantContent');
      el.innerHTML='<div class="g-card" style="text-align:center"><div class="spinner"></div><p style="color:var(--text2);margin-top:10px">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–ª—é—á—ñ–≤...</p></div>';
      api('/api/binance/keys','POST',{user_id:uid(),api_key:ak,secret_key:sk}).then(function(r){
        if(r&&r.ok){App.toast('–ö–ª—é—á—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ! –ù—ñ–∫–Ω–µ–π–º: '+(r.nickname||''),'success');App.modules.accountant.render()}
        else{App.toast('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–ª—é—á—ñ–≤','error');App.modules.accountant.renderSetup()}
      }).catch(function(e){App.toast(e.message||'–ü–æ–º–∏–ª–∫–∞','error');App.modules.accountant.renderSetup()});
    },
    renderDisconnected:function(st){
      var el=document.getElementById('accountantContent');
      el.innerHTML=
        '<div class="g-card" style="text-align:center;padding:30px">'+
        '<div style="font-size:50px;margin-bottom:14px">üìä</div>'+
        '<h3 style="font-family:var(--font-display);font-size:16px;margin-bottom:10px">P2P –ë–£–•–ì–ê–õ–¢–ï–†</h3>'+
        '<p style="font-size:13px;color:var(--text2);margin-bottom:20px">'+(st?st.message||'Binance API –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ':'API —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π')+'</p>'+
        '<button class="btn btn-neon" onclick="App.modules.accountant.renderSetup()"><i class="fas fa-key"></i> –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫–ª—é—á—ñ</button></div>';
    },
    renderDashboard:function(dash,avgPrice,st,today){
      var el=document.getElementById('accountantContent');
      var nick=(dash&&dash.nickname)?dash.nickname:(st.nickname||'–¢—Ä–µ–π–¥–µ—Ä');
      var isMerchant=dash&&dash.is_merchant;
      var midPrice=(avgPrice&&avgPrice.avg_mid)?avgPrice.avg_mid:'‚Äî';
      var h='<div class="g-card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">'+
        '<div><div style="font-family:var(--font-display);font-size:12px;letter-spacing:1px;color:var(--neon)">BINANCE P2P</div>'+
        '<div style="font-size:13px;color:var(--text2);margin-top:2px">'+nick+' '+(isMerchant?merchantBadge():'')+'</div></div>'+
        '<div style="text-align:right"><div style="font-size:10px;color:var(--text3)">USDT/UAH <span style="font-size:8px;opacity:0.6">(—Å–µ—Ä.)</span></div>'+
        '<div style="font-family:var(--font-display);font-size:18px;color:var(--green)">‚Ç¥'+midPrice+'</div>';
      if(avgPrice&&avgPrice.avg_buy&&avgPrice.avg_sell){
        h+='<div style="font-size:9px;color:var(--text3)">–ö—É–ø: '+avgPrice.avg_buy+' / –ü—Ä–æ–¥: '+avgPrice.avg_sell+'</div>';
      }
      h+='</div></div>';

      if(dash&&dash.ok){
        var buy30=dash.buy_30d||{},sell30=dash.sell_30d||{};
        h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px">'+
          '<div style="padding:12px;background:var(--glass);border-radius:var(--r-sm);text-align:center">'+
          '<div style="font-size:11px;color:var(--text3)">–ö–£–ü–Ü–í–õ–Ø 30–¥</div>'+
          '<div style="font-family:var(--font-display);font-size:16px;color:var(--neon)">'+(buy30.total_count||0)+'</div>'+
          '<div style="font-size:11px;color:var(--text2)">'+(buy30.total_amount||0)+' USDT</div></div>'+
          '<div style="padding:12px;background:var(--glass);border-radius:var(--r-sm);text-align:center">'+
          '<div style="font-size:11px;color:var(--text3)">–ü–†–û–î–ê–ñ 30–¥</div>'+
          '<div style="font-family:var(--font-display);font-size:16px;color:var(--purple)">'+(sell30.total_count||0)+'</div>'+
          '<div style="font-size:11px;color:var(--text2)">'+(sell30.total_amount||0)+' USDT</div></div></div>';
      }
      h+='</div>';

      // Action buttons
      h+='<div class="g-card"><div class="g2" style="gap:10px">'+
        '<button class="btn btn-neon btn-sm btn-block" onclick="App.modules.accountant.showOrders()"><i class="fas fa-list"></i> –£–≥–æ–¥–∏</button>'+
        '<button class="btn btn-purple btn-sm btn-block" onclick="App.modules.accountant.calcProfit()"><i class="fas fa-calculator"></i> FIFO</button></div>'+
        '<div class="g2" style="gap:10px;margin-top:10px">'+
        '<button class="btn btn-ghost btn-sm btn-block" onclick="App.modules.accountant.showSpreads()"><i class="fas fa-chart-line"></i> –ê–Ω–∞–ª—ñ–∑ —Å–ø—Ä–µ–¥—ñ–≤</button>'+
        '<button class="btn btn-ghost btn-sm btn-block" onclick="App.modules.accountant.showStats()"><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button></div>'+
        '<div style="margin-top:10px;text-align:center">'+
        '<button class="btn btn-ghost btn-sm" onclick="App.modules.accountant.resetKeys()" style="font-size:11px;padding:6px 12px;color:var(--text3)"><i class="fas fa-cog"></i> –ó–º—ñ–Ω–∏—Ç–∏ –∫–ª—é—á—ñ</button></div></div>';

      // Profit chart
      h+='<div class="g-card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">'+
        '<div style="font-family:var(--font-display);font-size:12px;letter-spacing:1px">–ì–†–ê–§–Ü–ö –ü–†–ò–ë–£–¢–ö–£</div>'+
        '<div style="display:flex;gap:4px">'+
        '<button class="btn btn-ghost" style="padding:4px 8px;font-size:10px" onclick="App.modules.accountant.loadChart(7)">7–¥</button>'+
        '<button class="btn btn-ghost" style="padding:4px 8px;font-size:10px" onclick="App.modules.accountant.loadChart(14)">14–¥</button>'+
        '<button class="btn btn-ghost" style="padding:4px 8px;font-size:10px;border-color:var(--neon);color:var(--neon)" onclick="App.modules.accountant.loadChart(30)">30–¥</button></div></div>'+
        '<div id="chartWrap" style="position:relative;height:200px"><canvas id="profitChart"></canvas>'+
        '<div id="chartLoading" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center">'+
        '<div class="spinner"></div></div></div></div>';

      // Today stats section
      h+='<div class="g-card"><div style="font-family:var(--font-display);font-size:12px;letter-spacing:1px;margin-bottom:12px">'+
        '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="vertical-align:middle;margin-right:6px">'+
        '<circle cx="12" cy="12" r="10" stroke="var(--neon)" stroke-width="2" fill="none"/>'+
        '<path d="M12 6v6l4 2" stroke="var(--neon)" stroke-width="2" stroke-linecap="round"/></svg>'+
        '–°–¨–û–ì–û–î–ù–Ü</div><div id="todayStats">';
      if(today){
        h+=this._todayHtml(today);
      }else{
        h+='<div style="text-align:center;color:var(--text3);font-size:12px;padding:10px">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</div>';
      }
      h+='</div></div>';

      el.innerHTML=h;
      this.loadChart(30);
    },
    _todayHtml:function(t){
      var profColor=(t.profit||0)>=0?'var(--green)':'var(--red)';
      var profSign=(t.profit||0)>=0?'+':'';
      return '<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">'+
        '<div class="today-stat"><div class="ts-icon" style="background:rgba(0,240,255,0.1);color:var(--neon)">'+
        '<svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M12 19V5M5 12l7-7 7 7" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>'+
        '<div><div class="ts-label">–ö—É–ø—ñ–≤–ª—è</div><div class="ts-val">'+(t.buy_count||0)+'</div></div></div>'+
        '<div class="today-stat"><div class="ts-icon" style="background:rgba(168,85,247,0.1);color:var(--purple)">'+
        '<svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12l7 7 7-7" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>'+
        '<div><div class="ts-label">–ü—Ä–æ–¥–∞–∂</div><div class="ts-val">'+(t.sell_count||0)+'</div></div></div>'+
        '<div class="today-stat"><div class="ts-icon" style="background:rgba(0,240,255,0.06)">üíµ</div>'+
        '<div><div class="ts-label">–û–±—Å—è–≥ $</div><div class="ts-val">'+(t.buy_crypto+t.sell_crypto).toFixed(1)+'</div></div></div>'+
        '<div class="today-stat"><div class="ts-icon" style="background:rgba(16,185,129,0.06)">‚Ç¥</div>'+
        '<div><div class="ts-label">–û–±—Å—è–≥ ‚Ç¥</div><div class="ts-val">'+(t.buy_fiat+t.sell_fiat).toFixed(0)+'</div></div></div>'+
        '<div class="today-stat"><div class="ts-icon" style="background:rgba(0,240,255,0.06)">üìä</div>'+
        '<div><div class="ts-label">–°–µ—Ä. –∫—É–ø—ñ–≤–ª—è</div><div class="ts-val">'+(t.avg_buy||'‚Äî')+'</div></div></div>'+
        '<div class="today-stat"><div class="ts-icon" style="background:rgba(168,85,247,0.06)">üìà</div>'+
        '<div><div class="ts-label">–°–µ—Ä. –ø—Ä–æ–¥–∞–∂</div><div class="ts-val">'+(t.avg_sell||'‚Äî')+'</div></div></div></div>'+
        '<div style="margin-top:8px;padding:10px;background:linear-gradient(135deg,rgba(16,185,129,0.06),rgba(0,240,255,0.04));border:1px solid '+(profColor==="var(--green)"?"rgba(16,185,129,0.2)":"rgba(239,68,68,0.2)")+';border-radius:var(--r-xs);text-align:center">'+
        '<div style="font-size:10px;color:var(--text3);margin-bottom:2px">–ü–†–ò–ë–£–¢–û–ö –°–¨–û–ì–û–î–ù–Ü</div>'+
        '<div style="font-family:var(--font-display);font-size:20px;font-weight:800;color:'+profColor+'">'+profSign+(t.profit||0)+' ‚Ç¥</div></div>';
    },
    resetKeys:function(){
      if(!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∫–ª—é—á—ñ Binance?'))return;
      api('/api/binance/keys/'+uid(),'DELETE').then(function(){App.toast('–ö–ª—é—á—ñ –≤–∏–¥–∞–ª–µ–Ω–æ','info');App.modules.accountant.render()});
    },
    showOrders:function(){
      App.openModal('<div style="padding:10px"><h3 style="font-family:var(--font-display);font-size:14px;margin-bottom:14px;text-align:center">–Ü–°–¢–û–†–Ü–Ø –£–ì–û–î</h3>'+
        '<div class="g2" style="gap:8px;margin-bottom:12px">'+
        '<button class="btn btn-neon btn-sm btn-block" onclick="App.modules.accountant.loadOrders(\'BUY\')">–ö–£–ü–Ü–í–õ–Ø</button>'+
        '<button class="btn btn-purple btn-sm btn-block" onclick="App.modules.accountant.loadOrders(\'SELL\')">–ü–†–û–î–ê–ñ</button></div>'+
        '<div id="ordersList" style="max-height:400px;overflow-y:auto"><div class="spinner" style="margin:20px auto"></div></div></div>');
      this.loadOrders('BUY');
    },
    loadOrders:function(type){
      var el=document.getElementById('ordersList');
      if(!el)return;
      el.innerHTML='<div class="spinner" style="margin:20px auto"></div>';
      api('/api/binance/orders','POST',{user_id:uid(),trade_type:type,page:1,rows:15}).then(function(r){
        if(!r||!r.orders||!r.orders.length){el.innerHTML='<p style="text-align:center;color:var(--text3);padding:20px">–£–≥–æ–¥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>';return}
        var h='';
        for(var i=0;i<r.orders.length;i++){
          var o=r.orders[i],dt=o.createTime?new Date(o.createTime).toLocaleDateString('uk-UA'):'‚Äî';
          var amt=o.amount?parseFloat(o.amount).toFixed(2):'‚Äî';
          var pr=o.unitPrice?parseFloat(o.unitPrice).toFixed(2):'‚Äî';
          var total=o.totalPrice?parseFloat(o.totalPrice).toFixed(2):'‚Äî';
          var stColor=o.orderStatus==='COMPLETED'?'var(--green)':o.orderStatus==='CANCELLED_BY_SYSTEM'?'var(--red)':'var(--gold)';
          h+='<div style="padding:10px;border-bottom:1px solid var(--glass-border);font-size:12px">'+
            '<div style="display:flex;justify-content:space-between;margin-bottom:4px">'+
            '<span style="color:'+(type==='BUY'?'var(--green)':'var(--purple)')+';font-weight:700">'+type+'</span>'+
            '<span style="color:var(--text3)">'+dt+'</span></div>'+
            '<div style="display:flex;justify-content:space-between">'+
            '<span>'+amt+' '+(o.asset||'USDT')+'</span>'+
            '<span style="color:var(--text2)">@'+pr+'</span>'+
            '<span style="font-weight:600">'+total+' '+(o.fiat||'UAH')+'</span></div>'+
            '<div style="color:'+stColor+';font-size:11px;margin-top:2px">'+(o.statusLabel||'')+'</div></div>'
        }
        el.innerHTML=h;
      });
    },
    calcProfit:function(){
      App.openModal('<div style="text-align:center;padding:10px"><div style="font-size:40px;margin-bottom:10px">üßÆ</div>'+
        '<h3 style="font-family:var(--font-display);font-size:14px;margin-bottom:10px">FIFO –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†</h3>'+
        '<p style="font-size:13px;color:var(--text2);margin-bottom:14px">–ê–Ω–∞–ª—ñ–∑ —É–≥–æ–¥ –º–µ—Ç–æ–¥–æ–º FIFO</p>'+
        '<div class="g2" style="gap:8px;margin-bottom:12px">'+
        '<button class="btn btn-ghost btn-sm btn-block" onclick="App.modules.accountant.runFifo(7)">7 –¥–Ω</button>'+
        '<button class="btn btn-neon btn-sm btn-block" onclick="App.modules.accountant.runFifo(30)">30 –¥–Ω</button>'+
        '<button class="btn btn-ghost btn-sm btn-block" onclick="App.modules.accountant.runFifo(90)">90 –¥–Ω</button></div>'+
        '<div id="fifoResult"></div></div>');
    },
    runFifo:function(days){
      var el=document.getElementById('fifoResult');
      if(!el)return;
      el.innerHTML='<div class="spinner" style="margin:20px auto"></div><p style="font-size:11px;color:var(--text3)">–ê–Ω–∞–ª—ñ–∑ —É–≥–æ–¥... –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ —Ö–≤–∏–ª–∏–Ω—É</p>';
      api('/api/binance/profit','POST',{user_id:uid(),days:days,fiat:'UAH',asset:'USDT'}).then(function(r){
        if(!r){el.innerHTML='<p style="color:var(--red)">–ü–æ–º–∏–ª–∫–∞</p>';return}
        var fifoColor=(r.net_profit||0)>=0?'var(--green)':'var(--red)';
        var pair=(r.asset||'USDT')+'/'+(r.fiat||'UAH');
        var unmatch=r.unmatched_buy_crypto||0;
        el.innerHTML=
          '<div style="padding:14px;background:var(--glass);border-radius:var(--r-sm);text-align:left;font-size:12px">'+
          '<div style="text-align:center;margin-bottom:10px;font-size:11px;color:var(--text3)">–ü–∞—Ä–∞: <b>'+pair+'</b></div>'+
          '<div style="margin-bottom:8px"><span style="color:var(--text3)">–£–≥–æ–¥ –æ–±—Ä–æ–±–ª–µ–Ω–æ:</span> <b>'+(r.total_orders||0)+'</b> ('+
            (r.buy_orders||0)+' –∫—É–ø—ñ–≤–ª—è / '+(r.sell_orders||0)+' –ø—Ä–æ–¥–∞–∂)</div>'+
          '<div style="margin-bottom:8px"><span style="color:var(--text3)">–ö—É–ø–ª–µ–Ω–æ:</span> <b>'+(r.total_buy_crypto||0)+' '+(r.asset||'USDT')+'</b> –∑–∞ <b>'+(r.total_buy_fiat||0)+' '+(r.fiat||'UAH')+'</b></div>'+
          '<div style="margin-bottom:8px"><span style="color:var(--text3)">–ü—Ä–æ–¥–∞–Ω–æ:</span> <b>'+(r.total_sell_crypto||0)+' '+(r.asset||'USDT')+'</b> –∑–∞ <b>'+(r.total_sell_fiat||0)+' '+(r.fiat||'UAH')+'</b></div>'+
          (unmatch>0?'<div style="margin-bottom:8px"><span style="color:var(--text3)">–ó–∞–ª–∏—à–æ–∫ (–Ω–µ –ø—Ä–æ–¥–∞–Ω–æ):</span> <b>'+unmatch+' '+(r.asset||'USDT')+'</b></div>':'')+
          '<div style="margin-bottom:8px"><span style="color:var(--text3)">–ö–æ–º—ñ—Å—ñ—ó:</span> <b>'+(r.total_commission||0)+' '+(r.asset||'USDT')+'</b></div>'+
          '<div style="margin-bottom:8px"><span style="color:var(--text3)">–°–µ—Ä. —Ü—ñ–Ω–∞ –∫—É–ø—ñ–≤–ª—ñ:</span> <b>'+(r.avg_buy_price||0)+' '+(r.fiat||'UAH')+'</b></div>'+
          '<div style="margin-bottom:8px"><span style="color:var(--text3)">–°–µ—Ä. —Ü—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É:</span> <b>'+(r.avg_sell_price||0)+' '+(r.fiat||'UAH')+'</b></div>'+
          '<div style="margin-bottom:8px"><span style="color:var(--text3)">–°–ø—Ä–µ–¥:</span> <b>'+(r.avg_spread||0)+' '+(r.fiat||'UAH')+'</b></div>'+
          '<div style="font-size:16px;font-family:var(--font-display);color:'+fifoColor+';margin-top:12px;text-align:center">'+
          'FIFO –ü–†–ò–ë–£–¢–û–ö: '+(r.net_profit||0)+' '+(r.fiat||'UAH')+'</div>'+
          '<div style="font-size:10px;color:var(--text3);text-align:center;margin-top:4px">–ó—ñ—Å—Ç–∞–≤–ª–µ–Ω–æ '+(r.matched_crypto||0)+' '+(r.asset||'USDT')+' (–ø—Ä–æ–¥–∞–∂—ñ ‚Üí –Ω–∞–π—Å—Ç–∞—Ä—ñ—à—ñ –ø–æ–∫—É–ø–∫–∏)</div></div>';
      });
    },
    /* ‚îÄ‚îÄ Spread Analysis ‚îÄ‚îÄ */
    showSpreads:function(){
      App.openModal('<div style="padding:10px"><div style="text-align:center;margin-bottom:14px">'+
        '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" style="margin-bottom:6px">'+
        '<path d="M3 17l6-6 4 4 8-8" stroke="var(--neon)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>'+
        '<path d="M17 7h4v4" stroke="var(--neon)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>'+
        '<h3 style="font-family:var(--font-display);font-size:14px">–ê–ù–ê–õ–Ü–ó –°–ü–†–ï–î–Ü–í</h3>'+
        '<p style="font-size:11px;color:var(--text3);margin-top:4px">–°–µ—Ä–µ–¥–Ω—ñ —Å–ø—Ä–µ–¥–∏ –ø–æ –ª—ñ–º—ñ—Ç–∞—Ö (USDT/UAH)</p></div>'+
        '<div id="spreadsContent"><div class="spinner" style="margin:20px auto"></div></div></div>');
      api('/api/binance/spreads').then(function(r){
        var el=document.getElementById('spreadsContent');
        if(!r||!r.spreads){el.innerHTML='<p style="text-align:center;color:var(--text3)">–î–∞–Ω—ñ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ</p>';return}
        var limits=r.limits||[];
        var byLimit={};
        for(var i=0;i<r.spreads.length;i++){
          var s=r.spreads[i],lk=s.limit;
          if(!byLimit[lk])byLimit[lk]={};
          byLimit[lk][s.pay_type]=s;
        }
        var h='<table class="spread-tbl"><thead><tr><th>–õ—ñ–º—ñ—Ç ‚Ç¥</th><th>–¢–∏–ø</th><th>–ö—É–ø—ñ–≤–ª—è</th><th>–ü—Ä–æ–¥–∞–∂</th><th>–°–ø—Ä–µ–¥</th></tr></thead><tbody>';
        for(var j=0;j<limits.length;j++){
          var lim=limits[j];
          var types=['–ö–∞—Ä—Ç–∫–∞','IBAN'];
          for(var k=0;k<types.length;k++){
            var pt=types[k];
            var d=byLimit[lim]&&byLimit[lim][pt]?byLimit[lim][pt]:{};
            var spColor=d.spread>0?'var(--green)':d.spread<0?'var(--red)':'var(--text3)';
            var spSign=d.spread>0?'+':'';
            h+='<tr>'+(k===0?'<td rowspan="2" style="font-weight:700;font-family:var(--font-display);font-size:12px;border-right:1px solid var(--glass-border)">'+lim.toLocaleString()+'</td>':'')+
              '<td style="font-size:10px;color:'+(pt==='–ö–∞—Ä—Ç–∫–∞'?'var(--neon)':'var(--purple)')+'">'+
              '<svg width="10" height="10" viewBox="0 0 24 24" fill="none" style="vertical-align:middle;margin-right:2px">'+
              (pt==='–ö–∞—Ä—Ç–∫–∞'
                ?'<rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2" fill="none"/><line x1="2" y1="10" x2="22" y2="10" stroke="currentColor" stroke-width="2"/>'
                :'<path d="M4 7h16M4 12h16M4 17h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>')+
              '</svg> '+pt+'</td>'+
              '<td>'+(d.avg_buy||'‚Äî')+'</td>'+
              '<td>'+(d.avg_sell||'‚Äî')+'</td>'+
              '<td style="color:'+spColor+';font-weight:700;font-family:var(--font-display)">'+(d.spread!=null?spSign+d.spread:'‚Äî')+
              (d.spread_pct!=null?' <span style="font-size:9px;font-weight:400">('+d.spread_pct+'%)</span>':'')+'</td></tr>';
          }
        }
        h+='</tbody></table>';
        h+='<div style="margin-top:10px;font-size:10px;color:var(--text3);text-align:center">'+
          '<svg width="10" height="10" viewBox="0 0 24 24" fill="none" style="vertical-align:middle"><circle cx="12" cy="12" r="10" stroke="var(--text3)" stroke-width="2" fill="none"/><path d="M12 8v4M12 16h.01" stroke="var(--text3)" stroke-width="2" stroke-linecap="round"/></svg>'+
          ' –î–∞–Ω—ñ –∑ P2P —Å—Ç–∞–∫–∞–Ω—É Binance –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ</div>';
        el.innerHTML=h;
      });
    },
    /* ‚îÄ‚îÄ Extended Statistics ‚îÄ‚îÄ */
    showStats:function(){
      App.openModal('<div style="padding:10px"><div style="text-align:center;margin-bottom:14px">'+
        '<svg width="36" height="36" viewBox="0 0 24 24" fill="none" style="margin-bottom:6px">'+
        '<path d="M18 20V10M12 20V4M6 20v-6" stroke="var(--neon)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'+
        '<h3 style="font-family:var(--font-display);font-size:14px">–°–¢–ê–¢–ò–°–¢–ò–ö–ê</h3></div>'+
        '<!-- Tab buttons -->'+
        '<div style="display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap;justify-content:center">'+
        '<button class="btn btn-neon btn-sm" onclick="App.modules.accountant.loadStatsTab(\'account\')" id="stTabAccount">–ê–∫–∞—É–Ω—Ç</button>'+
        '<button class="btn btn-ghost btn-sm" onclick="App.modules.accountant.loadStatsTab(\'today\')" id="stTabToday">–°—å–æ–≥–æ–¥–Ω—ñ</button>'+
        '<button class="btn btn-ghost btn-sm" onclick="App.modules.accountant.loadStatsTab(\'month\')" id="stTabMonth">–ú—ñ—Å—è—Ü—å</button>'+
        '<button class="btn btn-ghost btn-sm" onclick="App.modules.accountant.loadStatsTab(\'period\')" id="stTabPeriod">–ü–µ—Ä—ñ–æ–¥</button></div>'+
        '<div id="statsContent"><div class="spinner" style="margin:20px auto"></div></div></div>');
      this.loadStatsTab('account');
    },
    loadStatsTab:function(tab){
      var el=document.getElementById('statsContent');
      if(!el)return;
      // Update tab styles
      var tabs=['account','today','month','period'];
      for(var i=0;i<tabs.length;i++){
        var btn=document.getElementById('stTab'+tabs[i].charAt(0).toUpperCase()+tabs[i].slice(1));
        if(btn){btn.className=tabs[i]===tab?'btn btn-neon btn-sm':'btn btn-ghost btn-sm'}
      }
      el.innerHTML='<div class="spinner" style="margin:20px auto"></div>';
      var self=this;
      if(tab==='account'){
        api('/api/binance/stats?user_id='+uid()).then(function(r){
          if(!r){el.innerHTML='<p style="color:var(--text3)">–î–∞–Ω—ñ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ</p>';return}
          var isMerch=r.isMerchant;
          el.innerHTML=
            '<div style="text-align:left;font-size:12px;padding:12px;background:var(--glass);border-radius:var(--r-sm)">'+
            '<div style="margin-bottom:8px;display:flex;align-items:center;gap:6px"><span style="color:var(--text3)">–ù—ñ–∫–Ω–µ–π–º:</span> <b>'+(r.nickname||'‚Äî')+'</b>'+(isMerch?(' '+merchantBadge()):'')+'</div>'+
            '<div style="margin-bottom:6px"><span style="color:var(--text3)">–î–Ω—ñ–≤ –Ω–∞ Binance:</span> <b>'+(r.registerDays||'‚Äî')+'</b></div>'+
            '<div style="margin-bottom:6px"><span style="color:var(--text3)">KYC:</span> <b>'+(r.kycPassed?'‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ':'‚ùå –ù—ñ')+'</b></div>'+
            '<div style="margin-bottom:6px"><span style="color:var(--text3)">–¢–∏–ø:</span> <b>'+(isMerch?'–ú–µ—Ä—á–∞–Ω—Ç':'–ó–≤–∏—á–∞–π–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á')+'</b></div>'+
            '<div style="margin-bottom:6px"><span style="color:var(--text3)">–í—Å—å–æ–≥–æ —É–≥–æ–¥ (30–¥):</span> <b>'+(r.orderCount30d||0)+'</b></div>'+
            '<div style="margin-bottom:6px"><span style="color:var(--text3)">–í–∏–∫–æ–Ω–∞–Ω–æ (30–¥):</span> <b>'+(r.completedCount30d||0)+'</b></div>'+
            '<div><span style="color:var(--text3)">Completion rate:</span> <b>'+(r.completionRate||0)+'%</b></div></div>';
        });
      }else if(tab==='today'){
        api('/api/binance/today?user_id='+uid()).then(function(t){
          if(!t){el.innerHTML='<p style="color:var(--text3)">–î–∞–Ω—ñ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ</p>';return}
          el.innerHTML=self._todayHtml(t);
        });
      }else if(tab==='month'){
        el.innerHTML='<div class="spinner" style="margin:20px auto"></div><p style="font-size:11px;color:var(--text3);text-align:center">–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ FIFO –∑–∞ 30 –¥–Ω—ñ–≤...</p>';
        api('/api/binance/profit','POST',{user_id:uid(),days:30,fiat:'UAH',asset:'USDT'}).then(function(r){
          if(!r){el.innerHTML='<p style="color:var(--red)">–ü–æ–º–∏–ª–∫–∞</p>';return}
          self._renderProfitResult(el,r,'30 –¥–Ω—ñ–≤');
        });
      }else if(tab==='period'){
        var today=new Date().toISOString().split('T')[0];
        var monthAgo=new Date(Date.now()-30*86400000).toISOString().split('T')[0];
        el.innerHTML=
          '<div style="padding:10px;background:var(--glass);border-radius:var(--r-sm);margin-bottom:12px">'+
          '<div style="font-size:12px;color:var(--text2);margin-bottom:8px">–û–±–µ—Ä—ñ—Ç—å –ø–µ—Ä—ñ–æ–¥:</div>'+
          '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px">'+
          '<div><label style="font-size:10px;color:var(--text3);display:block;margin-bottom:3px">–í—ñ–¥</label>'+
          '<input type="date" id="statDateFrom" value="'+monthAgo+'" class="date-input"></div>'+
          '<div><label style="font-size:10px;color:var(--text3);display:block;margin-bottom:3px">–î–æ</label>'+
          '<input type="date" id="statDateTo" value="'+today+'" class="date-input"></div></div>'+
          '<button class="btn btn-neon btn-sm btn-block" onclick="App.modules.accountant.runPeriodStats()">'+
          '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="vertical-align:middle;margin-right:4px">'+
          '<path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/></svg>'+
          '–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏</button></div>'+
          '<div id="periodResult"></div>';
      }
    },
    runPeriodStats:function(){
      var from=document.getElementById('statDateFrom').value;
      var to=document.getElementById('statDateTo').value;
      var el=document.getElementById('periodResult');
      if(!from||!to||!el)return;
      el.innerHTML='<div class="spinner" style="margin:20px auto"></div><p style="font-size:11px;color:var(--text3);text-align:center">–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ FIFO...</p>';
      var self=this;
      api('/api/binance/profit','POST',{user_id:uid(),fiat:'UAH',asset:'USDT',start_date:from,end_date:to}).then(function(r){
        if(!r){el.innerHTML='<p style="color:var(--red)">–ü–æ–º–∏–ª–∫–∞</p>';return}
        self._renderProfitResult(el,r,from+' ‚Äî '+to);
      });
    },
    _renderProfitResult:function(el,r,label){
      var fifoColor=(r.net_profit||0)>=0?'var(--green)':'var(--red)';
      var profSign=(r.net_profit||0)>=0?'+':'';
      el.innerHTML=
        '<div style="text-align:center;margin-bottom:10px;font-size:11px;color:var(--text3)">'+label+'</div>'+
        '<div style="padding:14px;background:var(--glass);border-radius:var(--r-sm);font-size:12px">'+
        '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px">'+
        '<div class="today-stat"><div class="ts-icon" style="background:rgba(0,240,255,0.08)">üì•</div>'+
        '<div><div class="ts-label">–ö—É–ø–ª–µ–Ω–æ</div><div class="ts-val">'+(r.total_buy_crypto||0)+' $</div></div></div>'+
        '<div class="today-stat"><div class="ts-icon" style="background:rgba(168,85,247,0.08)">üì§</div>'+
        '<div><div class="ts-label">–ü—Ä–æ–¥–∞–Ω–æ</div><div class="ts-val">'+(r.total_sell_crypto||0)+' $</div></div></div>'+
        '<div class="today-stat"><div class="ts-icon" style="background:rgba(0,240,255,0.06)">üî¢</div>'+
        '<div><div class="ts-label">–£–≥–æ–¥</div><div class="ts-val">'+(r.total_orders||0)+'</div></div></div>'+
        '<div class="today-stat"><div class="ts-icon" style="background:rgba(251,191,36,0.06)">üìä</div>'+
        '<div><div class="ts-label">–°–ø—Ä–µ–¥</div><div class="ts-val">'+(r.avg_spread||0)+' ‚Ç¥</div></div></div></div>'+
        '<div style="margin-bottom:6px"><span style="color:var(--text3)">–í–∏—Ç—Ä–∞—Ç–∏:</span> <b>'+(r.total_buy_fiat||0)+' ‚Ç¥</b></div>'+
        '<div style="margin-bottom:6px"><span style="color:var(--text3)">–í–∏—Ä—É—á–∫–∞:</span> <b>'+(r.total_sell_fiat||0)+' ‚Ç¥</b></div>'+
        '<div style="margin-bottom:6px"><span style="color:var(--text3)">–ö–æ–º—ñ—Å—ñ—ó:</span> <b>'+(r.total_commission||0)+' USDT</b></div>'+
        '<div style="text-align:center;margin-top:12px;padding:10px;background:linear-gradient(135deg,rgba(16,185,129,0.06),rgba(0,240,255,0.04));border:1px solid '+(fifoColor==='var(--green)'?'rgba(16,185,129,0.2)':'rgba(239,68,68,0.2)')+';border-radius:var(--r-xs)">'+
        '<div style="font-size:10px;color:var(--text3)">FIFO –ü–†–ò–ë–£–¢–û–ö</div>'+
        '<div style="font-family:var(--font-display);font-size:20px;font-weight:800;color:'+fifoColor+'">'+profSign+(r.net_profit||0)+' ‚Ç¥</div></div></div>';
    },
    /* ‚îÄ‚îÄ Profit Chart ‚îÄ‚îÄ */
    loadChart:function(days){
      var loading=document.getElementById('chartLoading');
      if(loading)loading.style.display='flex';
      var self=this;
      api('/api/binance/chart?user_id='+uid()+'&days='+days).then(function(r){
        if(loading)loading.style.display='none';
        if(!r||!r.days||!r.days.length){self.renderChartEmpty();return}
        self.renderChart(r.days);
      }).catch(function(){
        if(loading)loading.style.display='none';
        self.renderChartEmpty();
      });
    },
    renderChartEmpty:function(){
      var ctx=document.getElementById('profitChart');if(!ctx)return;
      if(chart)chart.destroy();
      chart=new Chart(ctx,{type:'line',data:{labels:[''],datasets:[{label:'Profit',data:[0],borderColor:'#475569',borderWidth:1}]},
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},
          scales:{x:{display:false},y:{display:false}}}});
    },
    renderChart:function(data){
      var ctx=document.getElementById('profitChart');if(!ctx)return;
      if(chart)chart.destroy();
      var labels=[],profits=[],volumes=[],colors=[];
      for(var i=0;i<data.length;i++){
        labels.push(data[i].label);
        profits.push(data[i].profit);
        volumes.push(data[i].volume_fiat);
        colors.push(data[i].profit>=0?'rgba(16,185,129,0.7)':'rgba(239,68,68,0.7)');
      }
      chart=new Chart(ctx,{type:'bar',data:{labels:labels,
        datasets:[
          {type:'line',label:'–ü—Ä–∏–±—É—Ç–æ–∫ ‚Ç¥',data:profits,borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.1)',
            tension:0.4,fill:true,pointRadius:3,pointBackgroundColor:colors,borderWidth:2,yAxisID:'y',order:1},
          {type:'bar',label:'–û–±—Å—è–≥ ‚Ç¥',data:volumes,backgroundColor:'rgba(0,240,255,0.08)',borderColor:'rgba(0,240,255,0.2)',
            borderWidth:1,borderRadius:3,yAxisID:'y1',order:2}
        ]},
        options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},
          plugins:{legend:{labels:{color:'#94a3b8',font:{family:'Orbitron',size:9},boxWidth:12}},
            tooltip:{backgroundColor:'rgba(10,10,30,0.95)',borderColor:'rgba(0,240,255,0.2)',borderWidth:1,
              titleFont:{family:'Orbitron',size:11},bodyFont:{family:'Inter',size:12},
              callbacks:{label:function(ctx2){return ctx2.dataset.label+': '+ctx2.parsed.y.toLocaleString()+' ‚Ç¥'}}}},
          scales:{x:{ticks:{color:'#475569',font:{family:'Orbitron',size:8},maxRotation:45},grid:{color:'rgba(255,255,255,0.03)'}},
            y:{position:'left',ticks:{color:'#10b981',font:{family:'Orbitron',size:9},callback:function(v){return v+'‚Ç¥'}},grid:{color:'rgba(255,255,255,0.03)'}},
            y1:{position:'right',ticks:{color:'#475569',font:{size:8},callback:function(v){return ''}},grid:{display:false}}}}});
    }
  };
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE: PROFILE
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
App.modules.profile=(function(){
  var ch=null;
  return{
    init:function(){},
    render:function(){
      var s=App.state,name=App.user?App.user.first_name:'–ì—Ä–∞–≤–µ—Ü—å';
      var l=lvlOf(s.xp),p=xpProg(s.xp),pct=p.need>0?Math.min(100,Math.round(p.cur/p.need*100)):0;
      document.getElementById('profAvatar').src=avatarUrl(name,160);
      document.getElementById('profName').textContent=name;
      document.getElementById('profRank').textContent=rankOf(l)+' ‚Ä¢ Lv.'+l;
      var planBadge=document.getElementById('profPlan');
      if(s.plan==='pro'){planBadge.textContent='PRO';planBadge.className='plan-badge tag-pro'}
      else if(s.plan==='basic'){planBadge.textContent='BASIC';planBadge.className='plan-badge tag-basic'}
      else{planBadge.textContent='FREE';planBadge.className='plan-badge';planBadge.style.cssText='background:var(--glass);color:var(--text3);border:1px solid var(--glass-border)'}
      document.getElementById('profXpFill').style.width=pct+'%';
      document.getElementById('profXpText').textContent=s.xp+' XP ‚Ä¢ '+p.cur+'/'+p.need+' ‚Üí Lv.'+(l+1);
      document.getElementById('profStats').innerHTML=
        '<div class="stat-box"><div class="stat-val">'+s.streak+'</div><div class="stat-label">STREAK</div></div>'+
        '<div class="stat-box"><div class="stat-val">'+s.qOk+'</div><div class="stat-label">QUIZ</div></div>'+
        '<div class="stat-box"><div class="stat-val">'+(s.pos||'‚Äî')+'</div><div class="stat-label">RANK</div></div>';
      document.getElementById('profCourses').innerHTML=
        '<div style="font-family:var(--font-display);font-size:12px;letter-spacing:1px;margin-bottom:10px">–ü–†–û–ì–†–ï–°</div>'+
        '<div style="margin-bottom:8px"><div style="display:flex;justify-content:space-between;font-size:12px"><span>Basic</span><span>'+s.c1.length+'/'+TOTAL+'</span></div><div class="xp-bar" style="margin-top:4px"><div class="fill" style="width:'+(s.c1.length/TOTAL*100)+'%"></div></div></div>'+
        '<div><div style="display:flex;justify-content:space-between;font-size:12px"><span>Pro</span><span>'+s.c2.length+'/'+TOTAL+'</span></div><div class="xp-bar" style="margin-top:4px"><div class="fill" style="width:'+(s.c2.length/TOTAL*100)+'%;background:linear-gradient(90deg,var(--purple),var(--pink))"></div></div></div>';
      // achs
      var ks=Object.keys(ACHIEVEMENTS),ah='';
      for(var i=0;i<Math.min(6,ks.length);i++){var k=ks[i],a=ACHIEVEMENTS[k],e=s.achs.indexOf(k)>=0;
        ah+='<div class="ach'+(e?' earned':' locked')+'" onclick="App.modules.achievements.show(\''+k+'\')"><span class="emoji">'+a.icon+'</span><div class="a-title">'+a.title+'</div></div>'}
      document.getElementById('profAchs').innerHTML=ah;
      this.renderChart();App.incChallenge('profile');
    },
    renderChart:function(){var ctx=document.getElementById('profChart');if(!ctx)return;if(ch)ch.destroy();
      ch=new Chart(ctx,{type:'line',data:{labels:['T1','T2','T3','T4','T5'],
        datasets:[{label:'Basic',data:[0,Math.min(3,App.state.c1.length),Math.min(6,App.state.c1.length),Math.min(8,App.state.c1.length),App.state.c1.length],borderColor:'#00f0ff',tension:.4,fill:false,borderWidth:2},
        {label:'Pro',data:[0,Math.min(2,App.state.c2.length),Math.min(4,App.state.c2.length),Math.min(7,App.state.c2.length),App.state.c2.length],borderColor:'#a855f7',tension:.4,fill:false,borderWidth:2}]},
        options:{responsive:true,plugins:{legend:{labels:{color:'#94a3b8',font:{family:'Orbitron',size:10}}}},
          scales:{x:{ticks:{color:'#475569'}},y:{beginAtZero:true,max:TOTAL,ticks:{color:'#475569'}}}}})},
    exportData:function(){if(App.online){api('/api/export?user_id='+App.userId).then(function(d){
      if(d){var b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'}),u=URL.createObjectURL(b),a=document.createElement('a');
        a.href=u;a.download='smilskiy_'+App.userId+'.json';a.click();URL.revokeObjectURL(u);App.toast('–ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!');return}
      doLocal()});}else doLocal();function doLocal(){var b=new Blob([JSON.stringify(App.state,null,2)],{type:'application/json'}),
        u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download='smilskiy_export.json';a.click();URL.revokeObjectURL(u);App.toast('–û—Ñ–ª–∞–π–Ω-–µ–∫—Å–ø–æ—Ä—Ç!')}}
  };
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE: LEADERBOARD
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
App.modules.leaderboard=(function(){
  return{
    init:function(){},
    render:function(){
      var self=this;
      var doRender=function(lb){
        if(!lb||!lb.length){var names=['–û–ª–µ–∫—Å—ñ–π','–ú–∞—Ä—ñ—è','–î–º–∏—Ç—Ä–æ','–ê–Ω—è','–Ü–≤–∞–Ω','–ö–∞—Ç—è','–ú–∏–∫–æ–ª–∞','–¢–µ—Ç—è–Ω–∞','–ë–æ–≥–¥–∞–Ω','–Æ–ª—ñ—è'];
          lb=names.map(function(n,i){return{position:i+1,first_name:n,xp:Math.max(0,2000-i*180),level:Math.max(1,12-i),
            rank:rankOf(Math.max(1,12-i))}});
          lb.push({position:0,first_name:App.user?App.user.first_name:'–Ø',xp:App.state.xp,level:lvlOf(App.state.xp),
            user_id:App.userId,rank:rankOf(lvlOf(App.state.xp))});
          lb.sort(function(a,b){return b.xp-a.xp});lb.forEach(function(u,i){u.position=i+1})}
        // podium
        var t3=[];if(lb[1])t3.push(lb[1]);if(lb[0])t3.push(lb[0]);if(lb[2])t3.push(lb[2]);
        var pc=['pod-2','pod-1','pod-3'],medals=['ü•à','ü•á','ü•â'],ph='';
        for(var i=0;i<t3.length;i++){var u=t3[i];
          ph+='<div class="pod '+pc[i]+'"><div class="medal">'+medals[i]+'</div><img src="'+avatarUrl(u.first_name,64)+'" alt=""><div class="p-name">'+(u.first_name||'?')+'</div><div class="p-xp">'+(u.xp||0)+' XP</div></div>'}
        document.getElementById('lbPodium').innerHTML=ph;
        var lh='';for(var j=3;j<lb.length;j++){var u2=lb[j],me=u2.user_id===App.userId;
          lh+='<div class="lb-row'+(me?' me':'')+'"><div class="lb-pos">'+u2.position+'</div><img src="'+avatarUrl(u2.first_name,48)+'"><div class="lb-info"><div class="lb-name">'+(u2.first_name||'?')+'</div><div class="lb-rank">'+(u2.rank||rankOf(u2.level||1))+'</div></div><div class="lb-xp">'+(u2.xp||0)+'</div></div>'}
        document.getElementById('lbList').innerHTML=lh;
      };
      if(App.online)api('/api/leaderboard?limit=20').then(doRender);else doRender(null);
    }
  };
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE: ACHIEVEMENTS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
App.modules.achievements=(function(){
  return{
    init:function(){},
    renderAll:function(){var ks=Object.keys(ACHIEVEMENTS),h='',earned=0;
      for(var i=0;i<ks.length;i++){var k=ks[i],a=ACHIEVEMENTS[k],e=App.state.achs.indexOf(k)>=0;if(e)earned++;
        h+='<div class="ach'+(e?' earned':' locked')+'" onclick="App.modules.achievements.show(\''+k+'\')"><span class="emoji">'+a.icon+'</span><div class="a-title">'+a.title+'</div></div>'}
      document.getElementById('achGrid').innerHTML=h;document.getElementById('achCount').textContent=earned+'/'+ks.length},
    show:function(k){var a=ACHIEVEMENTS[k];if(!a)return;var e=App.state.achs.indexOf(k)>=0;
      App.openModal('<div style="text-align:center;padding:10px"><div style="font-size:50px;margin-bottom:10px'+(e?'':';filter:grayscale(1);opacity:.4')+'">'+a.icon+'</div><h3 style="font-family:var(--font-display);font-size:16px;margin-bottom:6px">'+a.title+'</h3><p style="font-size:13px;color:var(--text2)">'+a.desc+'</p><div style="margin-top:12px;font-size:12px;font-family:var(--font-display);color:'+(e?'var(--green)':'var(--text3)')+'">'+
        (e?'‚úì –û–¢–†–ò–ú–ê–ù–û':'üîí –ó–ê–ë–õ–û–ö–û–í–ê–ù–û')+'</div></div>')},
    earn:function(k){if(App.state.achs.indexOf(k)>=0)return;App.state.achs.push(k);var a=ACHIEVEMENTS[k];
      App.toast(a.icon+' '+a.title+'!','info');if(typeof confetti==='function')confetti({particleCount:60,spread:80,origin:{y:0.6}})}
  };
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE: REFERRALS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
App.modules.referrals=(function(){
  return{init:function(){},
    copy:function(){var link=document.getElementById('refLink').value;
      if(navigator.clipboard)navigator.clipboard.writeText(link).then(function(){App.toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!','info')});
      else{var i=document.getElementById('refLink');i.select();document.execCommand('copy');App.toast('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!','info')}}
  };
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE: SETTINGS
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
App.modules.settings=(function(){
  return{
    init:function(){},
    render:function(){
      var t=document.getElementById('notifToggle');t.classList.add('on');
      document.getElementById('refCount').textContent=App.state.refCount;
      document.getElementById('refLink').value='https://t.me/SmilskiyBot?start=ref_'+App.userId;
      if(App.online)api('/api/settings?user_id='+App.userId).then(function(s){if(s)t.classList.toggle('on',s.notifications_enabled)});
    },
    toggleNotif:function(){var t=document.getElementById('notifToggle'),on=!t.classList.contains('on');
      t.classList.toggle('on',on);if(App.online)api('/api/settings','POST',{user_id:App.userId,notifications_enabled:on})}
  };
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE: ADMIN
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
App.modules.admin=(function(){
  function loadUsers(){
    api('/api/admin/users').then(function(d){
      if(!d||!d.users){document.getElementById('adminUsers').innerHTML='<div style="text-align:center;padding:20px;color:var(--text3)">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div>';return}
      var h='';d.users.forEach(function(u){
        var plan=u.plan||'free';var planBadge=plan==='pro'?'<span style="color:var(--purple);font-weight:700">PRO</span>':plan==='basic'?'<span style="color:var(--cyan);font-weight:700">BASIC</span>':'<span style="color:var(--text3)">FREE</span>';
        h+='<div class="admin-user-row" style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--glass-border)">'
          +'<div><div style="font-weight:600;font-size:13px">'+(u.first_name||'User')+' <span style="color:var(--text3);font-size:11px">ID:'+u.user_id+'</span></div>'
          +'<div style="font-size:11px;color:var(--text3)">Lv.'+(u.level||1)+' ¬∑ XP:'+(u.xp||0)+' ¬∑ '+planBadge+'</div></div>'
          +'<div style="display:flex;gap:6px">'
          +'<button class="btn btn-ghost btn-sm" onclick="App.modules.admin.setAccess('+u.user_id+',\'basic\')" title="Basic">B</button>'
          +'<button class="btn btn-purple btn-sm" onclick="App.modules.admin.setAccess('+u.user_id+',\'pro\')" title="Pro">P</button>'
          +'<button class="btn btn-ghost btn-sm" style="color:var(--red)" onclick="App.modules.admin.setAccess('+u.user_id+',\'revoke\')" title="–ó–∞–±—Ä–∞—Ç–∏"><i class="fas fa-ban"></i></button>'
          +'</div></div>'
      });
      document.getElementById('adminUsers').innerHTML=h||'<div style="text-align:center;padding:20px;color:var(--text3)">–ù–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</div>';
    })
  }
  return{
    init:function(){},
    render:function(){
      if(ADMINS.indexOf(App.userId)<0){App.go('home');return}
      document.getElementById('adminStats').innerHTML=
        '<div class="a-box"><div class="a-val">‚Äî</div><div class="a-lbl">Users</div></div>'+
        '<div class="a-box"><div class="a-val">‚Äî</div><div class="a-lbl">Pro</div></div>'+
        '<div class="a-box"><div class="a-val">‚Äî</div><div class="a-lbl">Basic</div></div>'+
        '<div class="a-box"><div class="a-val">‚Äî</div><div class="a-lbl">–£—Ä–æ–∫—ñ–≤</div></div>';
      if(App.online){
        api('/api/admin/stats').then(function(d){
          if(d){var boxes=document.querySelectorAll('#adminStats .a-val');
            if(boxes[0])boxes[0].textContent=d.total_users||0;
            if(boxes[1])boxes[1].textContent=d.pro_users||0;
            if(boxes[2])boxes[2].textContent=d.basic_users||0;
            if(boxes[3])boxes[3].textContent=d.total_lessons_viewed||0}});
        loadUsers();
      }
    },
    setAccess:function(uid,plan){
      var action=plan==='revoke'?'revoke':'grant';
      var p=plan==='revoke'?'free':plan;
      api('/api/admin/grant','POST',{user_id:uid,action:action,plan:p}).then(function(d){
        if(d&&d.ok){App.toast((action==='revoke'?'–î–æ—Å—Ç—É–ø –∑–∞–±—Ä–∞–Ω–æ':'–î–æ—Å—Ç—É–ø '+p.toUpperCase()+' –≤–∏–¥–∞–Ω–æ'),'success');loadUsers()}
        else{App.toast('–ü–æ–º–∏–ª–∫–∞: '+(d&&d.detail||'–Ω–µ–≤—ñ–¥–æ–º–æ'),'error')}
      })
    },
    broadcast:function(){App.openModal('<div style="text-align:center;padding:10px"><h3 style="font-family:var(--font-display);font-size:14px;margin-bottom:14px">–†–û–ó–°–ò–õ–ö–ê</h3><textarea id="broadcastText" placeholder="–¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." style="width:100%;height:100px;padding:10px;background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--r-sm);color:var(--text);font-family:var(--font-body);font-size:13px;resize:none;outline:none;margin-bottom:12px"></textarea><button class="btn btn-neon btn-block" onclick="App.modules.admin.sendBroadcast()">–í–Ü–î–ü–†–ê–í–ò–¢–ò</button></div>')},
    sendBroadcast:function(){
      var txt=document.getElementById('broadcastText');if(!txt||!txt.value.trim()){App.toast('–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç','error');return}
      api('/api/admin/broadcast','POST',{text:txt.value.trim()}).then(function(d){
        if(d&&d.ok){App.toast('–†–æ–∑—Å–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞: '+d.sent+' –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º','success');App.closeModal()}
        else{App.toast('–ü–æ–º–∏–ª–∫–∞: '+(d&&d.detail||'–Ω–µ–≤—ñ–¥–æ–º–æ'),'error')}
      })
    },
    grantAccess:function(){App.openModal('<div style="text-align:center;padding:10px"><h3 style="font-family:var(--font-display);font-size:14px;margin-bottom:14px">–í–ò–î–ê–¢–ò –î–û–°–¢–£–ü</h3><div style="margin-bottom:10px"><input type="text" id="grantUserId" placeholder="User ID" style="width:100%;padding:10px;background:var(--glass);border:1px solid var(--glass-border);border-radius:var(--r-sm);color:var(--text);font-size:13px;outline:none"></div><div class="g2" style="margin-bottom:14px"><button class="btn btn-ghost btn-sm btn-block" onclick="App.modules.admin.setAccess(parseInt(document.getElementById(\'grantUserId\').value),\'basic\');App.closeModal()">BASIC</button><button class="btn btn-purple btn-sm btn-block" onclick="App.modules.admin.setAccess(parseInt(document.getElementById(\'grantUserId\').value),\'pro\');App.closeModal()">PRO</button></div></div>')}
  };
})();

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.addEventListener('DOMContentLoaded',function(){App.init()});
</script>
</body>
</html>
